2017-01-04  Babak Shafiei  <bshafiei@apple.com>

        Merge r210273.

    2017-01-04  Tim Horton  <timothy_horton@apple.com>

            Provide a setting for clients to always prefer low-power WebGL
            https://bugs.webkit.org/show_bug.cgi?id=166675
            <rdar://problem/29834093>

            Reviewed by Dan Bernstein.

            * WebView/WebPreferenceKeysPrivate.h:
            * WebView/WebPreferences.mm:
            (+[WebPreferences initialize]):
            (-[WebPreferences preferLowPowerWebGLRendering]):
            (-[WebPreferences setPreferLowPowerWebGLRendering:]):
            * WebView/WebPreferencesPrivate.h:
            * WebView/WebView.mm:
            (-[WebView _preferencesChanged:]):
            Expose a new private preferLowPowerWebGLRendering WebKit1 preference.

2016-10-31  Matthew Hanson  <matthew_hanson@apple.com>

        Merge r206802. rdar://problem/28409525

    2016-10-28  Said Abou-Hallawa  <sabouhallawa@apple.com>

            The dragged image should be the current frame only of the animated image
            https://bugs.webkit.org/show_bug.cgi?id=162109

            * Misc/WebElementDictionary.mm:
            (-[WebElementDictionary _image]): Call the Image function with its new name.
            * Misc/WebIconDatabase.mm:
            (-[WebIconDatabase defaultIconWithSize:]): Call snapshotNSImage() to create the icon image.
            (webGetNSImage): Call the Image function with its new name.
            * WebCoreSupport/WebContextMenuClient.mm:
            (WebContextMenuClient::imageForCurrentSharingServicePickerItem): Call snapshotNSImage() instead of nsImage()..
            (WebContextMenuClient::contextMenuForEvent): Ditto.
            * WebView/WebHTMLView.mm:
            (-[WebHTMLView pasteboard:provideDataForType:]): Call the Image function with its new name.

2016-10-26  Babak Shafiei  <bshafiei@apple.com>

        Merge r207171. rdar://problem/28857503

    2016-10-11  Daniel Bates  <dabates@apple.com>

            Attempt to fix the Apple Internal Mac build following r207159
            (https://bugs.webkit.org/show_bug.cgi?id=163244)

            * WebView/WebView.mm:
            (shouldRequireUserGestureToLoadVideo):

2016-10-20  Matthew Hanson  <matthew_hanson@apple.com>

        Merge r207160. rdar://problem/28857480

    2016-10-11  Daniel Bates  <dabates@apple.com>

            REGRESSION (r198251): -[UIWebView mediaPlaybackRequiresUserAction] defaults to NO
            https://bugs.webkit.org/show_bug.cgi?id=163259
            <rdar://problem/28680515>

            Reviewed by Jer Noble.

            In WebKit1 on iOS we want to require user action to load and play videos by default and
            allow an embedding app to change this behavior via -[UIWebView setMediaPlaybackRequiresUserAction:].
            Following r198251, -[UIWebView mediaPlaybackRequiresUserAction] defaults to NO and videos
            can load and play without being initiated by a user action.

            * WebView/WebPreferences.mm:
            (+[WebPreferences initialize]): Initialize the default value of the deprecated preference
            WebKitRequiresUserGestureForMediaPlaybackPreferenceKey to YES on iOS. The value of this
            preference takes precedence over the values of its replacement preferences
            WebKitRequiresUserGestureForVideoPlaybackPreferenceKey and WebKitRequiresUserGestureForAudioPlaybackPreferenceKey.

2016-10-20  Matthew Hanson  <matthew_hanson@apple.com>

        Merge r207159. rdar://problem/28857481

    2016-10-11  Daniel Bates  <dabates@apple.com>

            [iOS] REGRESSION (r197953): User gesture required to load video in iOS 9-built apps
            https://bugs.webkit.org/show_bug.cgi?id=163244
            <rdar://problem/27250015>

            Reviewed by Jer Noble.

            Enable or disable the Setting::requiresUserGestureToLoadVideo() in legacy WebKit depending
            on the version of iOS SDK that the app was linked against. We require a user gesture to
            begin loading a video as of iOS 10.

            * WebView/WebView.mm:
            (shouldRequireUserGestureToLoadVideo):
            (-[WebView _preferencesChanged:]): Modified to pass the WebKit requiresUserGestureToLoadVideo
            preference to WebCore.

2016-10-20  Matthew Hanson  <matthew_hanson>

        Merge r207385. rdar://problem/28811872

    2016-10-15  Dan Bernstein  <mitz@apple.com>

            REGRESSION (r191699): Contextual menu in Mail compose view doesnâ€™t include any of the standard submenus
            https://bugs.webkit.org/show_bug.cgi?id=163492
            <rdar://problem/28654799>

            Reviewed by Darin Adler.

            Test: TestWebKitAPI/Tests/mac/ContextMenuDefaultItemsHaveTags.mm

            * WebView/WebHTMLView.mm:
            (createMenuItem): Set the tag for items that have submenus as well.

2016-10-20  Matthew Hanson  <matthew_hanson@apple.com>

        Merge r207246. rdar://problem/28732731

    2016-10-12  Beth Dakin  <bdakin@apple.com>

            Adobe Contribute CS 6.5 Trial crashes on launch
            https://bugs.webkit.org/show_bug.cgi?id=163365
            -and corresponding-
            <rdar://problem/28732731>

            Reviewed by Tim Horton.

            * Carbon/CarbonWindowFrame.m:
            (-[CarbonWindowFrame contentFill]):

2016-10-20  Matthew Hanson  <matthew_hanson@apple.com>

        Merge r204637. rdar://problem/28216256

    2016-08-16  Simon Fraser  <simon.fraser@apple.com>

            Rename didLayout(LayoutMilestones) to didReachLayoutMilestone(), and related WK2 functions
            https://bugs.webkit.org/show_bug.cgi?id=160923

            Reviewed by Tim Horton.

            * WebCoreSupport/WebFrameLoaderClient.h:
            * WebCoreSupport/WebFrameLoaderClient.mm:
            (WebFrameLoaderClient::dispatchDidReachLayoutMilestone):
            (WebFrameLoaderClient::dispatchDidLayout): Deleted.

2016-09-26  Babak Shafiei  <bshafiei@apple.com>

        Merge r206238. rdar://problem/28450514

    2016-09-21  Anders Carlsson  <andersca@apple.com>

            Support openPaymentSetup API on ApplePaySession object
            https://bugs.webkit.org/show_bug.cgi?id=162357
            rdar://problem/26776939

            Reviewed by Tim Horton.

            Add openPaymentSetup stub.

            * WebCoreSupport/WebPaymentCoordinatorClient.h:
            * WebCoreSupport/WebPaymentCoordinatorClient.mm:
            (WebPaymentCoordinatorClient::openPaymentSetup):

2016-09-16  Babak Shafiei  <bshafiei@apple.com>

        Merge r206006. rdar://problem/27991573

    2016-09-15  Brady Eidson  <beidson@apple.com>

            WKWebView.hasOnlySecureContent always returns "YES" after going back to a CachedPage (even if it has http resources).
            <rdar://problem/27681261> and https://bugs.webkit.org/show_bug.cgi?id=162043

            Reviewed by Brent Fulgham.

            * WebCoreSupport/WebFrameLoaderClient.h:
            * WebCoreSupport/WebFrameLoaderClient.mm:
            (WebFrameLoaderClient::dispatchDidCommitLoad):

2016-09-16  Babak Shafiei  <bshafiei@apple.com>

        Merge r205991. rdar://problem/28272353

    2016-09-15  Beth Dakin  <bdakin@apple.com>

            Need hasMarkedText on Mac
            https://bugs.webkit.org/show_bug.cgi?id=162026
            -and corresponding-
            rdar://problem/28272353

            Reviewed by Anders Carlsson.

            * WebView/WebHTMLViewInternal.h:

2016-09-12  Babak Shafiei  <bshafiei@apple.com>

        Merge r205765. rdar://problem/28033492

    2016-09-09  Tim Horton  <timothy_horton@apple.com>

            Text replacement candidates don't always overwrite the entire original string
            https://bugs.webkit.org/show_bug.cgi?id=161779
            <rdar://problem/28033492>

            Reviewed by Simon Fraser.

            * WebCoreSupport/WebEditorClient.mm:
            (WebEditorClient::requestCandidatesForSelection):
            Make use of the shared implementation of contextRangeForCandidateRequest.

2016-09-09  Babak Shafiei  <bshafiei@apple.com>

        Merge r204456. rdar://problem/27860536

    2016-08-14  Daniel Bates  <dabates@apple.com>

            Fix compiler errors when building iOS WebKit using the iOS 10 beta SDK
            https://bugs.webkit.org/show_bug.cgi?id=160725

            Reviewed by Sam Weinig.

            OSAtomicCompareAndSwap32() has been deprecated as of the iOS 10 beta SDK. For now,
            silence the complier warning.

            * WebView/WebView.mm:
            (-[WebView _dispatchTileDidDraw:]):

2016-09-09  Babak Shafiei  <bshafiei@apple.com>

        Merge r203381. rdar://problem/27860536

    2016-07-18  Anders Carlsson  <andersca@apple.com>

            WebKit nightly fails to build on macOS Sierra
            https://bugs.webkit.org/show_bug.cgi?id=159902
            rdar://problem/27365672

            Reviewed by Tim Horton.

            * icu/unicode/ucurr.h: Added.
            Add ucurr.h from ICU.

2016-09-09  Babak Shafiei  <bshafiei@apple.com>

        Merge r205381. rdar://problem/27806012

    2016-09-02  Beth Dakin  <bdakin@apple.com>

            Need to updateEditorState if an element change edit-ability without changing
            selection
            https://bugs.webkit.org/show_bug.cgi?id=161546
            -and corresponding-
            rdar://problem/27806012

            Reviewed by Ryosuke Niwa.

            Every time WebEditorClient::respondToChangedSelection is called, we now save
            whether the last state was contentEditable. That way in
            updateEditorStateAfterLayoutIfNeeded() we can assess whether or not edit-ability
            has changed.

            * WebCoreSupport/WebEditorClient.h:
            * WebCoreSupport/WebEditorClient.mm:
            (WebEditorClient::respondToChangedSelection):
            (WebEditorClient:: updateEditorStateAfterLayoutIfEditabilityChanged):

2016-09-09  Babak Shafiei  <bshafiei@apple.com>

        Merge r205365. rdar://problem/28020157

    2016-07-08  Jer Noble  <jer.noble@apple.com>

            Refactor WebPlaybackSessionModelMediaElement to be client based.
            https://bugs.webkit.org/show_bug.cgi?id=159580

            Reviewed by Eric Carlson.

            No longer necessary to tell the models and interfaces about each other.

            * WebView/WebView.mm:
            (-[WebView _setUpPlaybackControlsManagerForMediaElement:]):
            (-[WebView _clearPlaybackControlsManager]):

2016-07-28  Babak Shafiei  <bshafiei@apple.com>

        Merge r203855. rdar://problem/27557968

    2016-07-28  Myles C. Maxfield  <mmaxfield@apple.com>

            Remove deprecated SPI for video inline / fullscreen controls
            https://bugs.webkit.org/show_bug.cgi?id=160318

            Reviewed by Tim Horton.

            * WebView/WebPreferenceKeysPrivate.h:
            * WebView/WebPreferences.mm:
            (+[WebPreferences initialize]): Deleted.
            (-[WebPreferences allowsInlineMediaPlaybackWithPlaysInlineAttribute]): Deleted.
            (-[WebPreferences setAllowsInlineMediaPlaybackWithPlaysInlineAttribute:]): Deleted.
            (-[WebPreferences allowsInlineMediaPlaybackWithWebKitPlaysInlineAttribute]): Deleted.
            (-[WebPreferences setAllowsInlineMediaPlaybackWithWebKitPlaysInlineAttribute:]): Deleted.
            * WebView/WebPreferencesPrivate.h:
            * WebView/WebView.mm:
            (-[WebView _preferencesChanged:]): Deleted.

2016-07-28  Babak Shafiei  <bshafiei@apple.com>

        Merge r203752. rdar://problem/27557968

    2016-07-26  Myles C. Maxfield  <mmaxfield@apple.com>

            [iPhone] Playing a video on tudou.com plays only sound, no video
            https://bugs.webkit.org/show_bug.cgi?id=160178
            <rdar://problem/27535468>

            Reviewed by Eric Carlson and Dan Bernstein.

            * WebView/WebPreferenceKeysPrivate.h:
            * WebView/WebPreferences.mm:
            (+[WebPreferences initialize]):
            (-[WebPreferences inlineMediaPlaybackRequiresPlaysInlineAttribute]):
            (-[WebPreferences setInlineMediaPlaybackRequiresPlaysInlineAttribute:]):
            * WebView/WebPreferencesPrivate.h:
            * WebView/WebView.mm:
            (-[WebView _preferencesChanged:]):

2016-07-22  Babak Shafiei  <bshafiei@apple.com>

        Merge r203545. rdar://problem/26964090

    2016-07-21  Myles C. Maxfield  <mmaxfield@apple.com>

            Remove support for deprecated SPI inlineMediaPlaybackRequiresPlaysInlineAttribute
            https://bugs.webkit.org/show_bug.cgi?id=160066

            Reviewed by Dean Jackson.

            * WebView/WebPreferenceKeysPrivate.h:
            * WebView/WebPreferences.mm:
            (+[WebPreferences initialize]): Deleted.
            (-[WebPreferences inlineMediaPlaybackRequiresPlaysInlineAttribute]): Deleted.
            (-[WebPreferences setInlineMediaPlaybackRequiresPlaysInlineAttribute:]): Deleted.
            * WebView/WebPreferencesPrivate.h:
            * WebView/WebView.mm:
            (-[WebView _preferencesChanged:]): Deleted.

2016-07-22  Babak Shafiei  <bshafiei@apple.com>

        Merge r203520. rdar://problem/26964090

    2016-07-21  Myles C. Maxfield  <mmaxfield@apple.com>

            [iPhone] Playing a video on tudou.com plays only sound, no video
            https://bugs.webkit.org/show_bug.cgi?id=159967
            <rdar://problem/26964090>

            Reviewed by Jon Lee, Jeremy Jones, and Anders Carlsson.

            Add the two preferences to WebPreferences.

            * WebView/WebPreferenceKeysPrivate.h:
            * WebView/WebPreferences.mm:
            (+[WebPreferences initialize]):
            (-[WebPreferences allowsInlineMediaPlaybackWithPlaysInlineAttribute]):
            (-[WebPreferences setAllowsInlineMediaPlaybackWithPlaysInlineAttribute:]):
            (-[WebPreferences allowsInlineMediaPlaybackWithWebKitPlaysInlineAttribute]):
            (-[WebPreferences setAllowsInlineMediaPlaybackWithWebKitPlaysInlineAttribute:]):
            * WebView/WebPreferencesPrivate.h:
            * WebView/WebView.mm:
            (-[WebView _preferencesChanged:]):

2016-07-22  Babak Shafiei  <bshafiei@apple.com>

        Merge r203435. rdar://problem/27438734

    2016-07-19  Andy Estes  <aestes@apple.com>

            Move WebKitErrorFrameLoadBlockedByContentFilter from WebKitErrors.h to WebKitErrorsPrivate.h
            https://bugs.webkit.org/show_bug.cgi?id=159956

            Reviewed by Dan Bernstein.

            * Misc/WebKitErrors.h: Moved definition of WebKitErrorFrameLoadBlockedByContentFilter from here ...
            * Misc/WebKitErrorsPrivate.h: to here.

2016-07-18  Babak Shafiei  <bshafiei@apple.com>

        Merge patch for rdar://problem/27360961.

    2016-06-23  Dean Jackson  <dino@apple.com>

            Disable some features on safari-602-branch.
            <rdar://problem/27360961>

            * Configurations/FeatureDefines.xcconfig:

2016-07-17  Sam Weinig  <sam@webkit.org>

        [WebKit API] Add SPI to track multiple navigations caused by a single user gesture
        <rdar://problem/26554137>
        https://bugs.webkit.org/show_bug.cgi?id=159856

        Reviewed by Dan Bernstein.

        * Plugins/Hosted/NetscapePluginInstanceProxy.mm:
        (WebKit::NetscapePluginInstanceProxy::evaluate):
        * Plugins/WebNetscapePluginView.mm:
        (-[WebNetscapePluginView sendEvent:isDrawRect:]):
        Update for new UserGestureIndicator interface.

2016-07-16  Ryosuke Niwa  <rniwa@webkit.org>

        Rename fastGetAttribute to attributeWithoutSynchronization
        https://bugs.webkit.org/show_bug.cgi?id=159852

        Reviewed by Darin Adler.

        * WebView/WebHTMLRepresentation.mm:
        (matchLabelsAgainstElement):

2016-07-15  Chris Dumez  <cdumez@apple.com>

        Use fastGetAttribute() / setAttributeWithoutSynchronization() when possible
        https://bugs.webkit.org/show_bug.cgi?id=159793

        Reviewed by Ryosuke Niwa.

        Use fastGetAttribute() / setAttributeWithoutSynchronization() when possible, for performance.

        * WebView/WebHTMLRepresentation.mm:
        (matchLabelsAgainstElement):

2016-07-14  Alex Christensen  <achristensen@webkit.org>

        Use SocketProvider to create SocketStreamHandles
        https://bugs.webkit.org/show_bug.cgi?id=159774

        Reviewed by Brady Eidson.

        * Misc/WebSocketProvider.h: Removed.
        * Misc/WebSocketProvider.mm: Removed.
        * WebView/WebView.mm:
        (-[WebView _commonInitializationWithFrameName:groupName:]):
        (-[WebView initSimpleHTMLDocumentWithStyle:frame:preferences:groupName:]):

2016-07-14  Csaba OsztrogonÃ¡c  <ossy@webkit.org>

        Fix the !ENABLE(WEB_SOCKETS) build after r202930
        https://bugs.webkit.org/show_bug.cgi?id=159768

        Reviewed by Alex Christensen.

        * Misc/WebSocketProvider.h:

2016-07-13  Beth Dakin  <bdakin@apple.com>

        Add more candidate tests
        https://bugs.webkit.org/show_bug.cgi?id=159730

        Reviewed by Tim Horton.

        Move shouldRequestCandidates from WebViewInternal to WebViewPrivate so that 
        we can use it in tests. 
        * WebView/WebViewInternal.h:
        * WebView/WebViewPrivate.h:

2016-07-13  Enrica Casucci  <enrica@apple.com>

        Update supported platforms in xcconfig files to match the sdk names.
        https://bugs.webkit.org/show_bug.cgi?id=159728

        Reviewed by Tim Horton.

        * Configurations/Base.xcconfig:

2016-07-12  Gyuyoung Kim  <gyuyoung.kim@webkit.org>

        Remove ENABLE_CSS3_TEXT_LINE_BREAK flag
        https://bugs.webkit.org/show_bug.cgi?id=159671

        Reviewed by Csaba OsztrogonÃ¡c.

        ENABLE_CSS3_TEXT_LINE_BREAK feature was implemented without guards.
        https://bugs.webkit.org/show_bug.cgi?id=89235

        So this guard can be removed in build scripts.

        * Configurations/FeatureDefines.xcconfig:

2016-07-11  Gyuyoung Kim  <gyuyoung.kim@webkit.org>

        Purge PassRefPtr in platform/efl and platform/mac 
        https://bugs.webkit.org/show_bug.cgi?id=159548

        Reviewed by Alex Christensen.

        Remove all use of PassRefPtr and clean up unnecessary tabs and spaces.

        * WebCoreSupport/WebPlatformStrategies.h:
        * WebCoreSupport/WebPlatformStrategies.mm:
        (WebPlatformStrategies::setBufferForType):

2016-07-11  Enrica Casucci  <enrica@apple.com>

        Add synthetic click origin to WKNavigationAction.
        https://bugs.webkit.org/show_bug.cgi?id=159584
        rdar://problem/25610422

        Reviewed by Tim Horton.

        * WebView/WebFrame.mm:
        (-[WebFrame _dragSourceEndedAt:operation:]):
        * WebView/WebPDFView.mm:
        (-[WebPDFView PDFViewWillClickOnLink:withURL:]):

2016-07-11  Anders Carlsson  <andersca@apple.com>

        Able to open multiple payment sheets in Safari at the same time
        https://bugs.webkit.org/show_bug.cgi?id=159637
        rdar://problem/26411339

        Reviewed by Beth Dakin.

        Update for WebCore changes.

        * WebCoreSupport/WebPaymentCoordinatorClient.h:
        * WebCoreSupport/WebPaymentCoordinatorClient.mm:
        (WebPaymentCoordinatorClient::showPaymentUI):

2016-07-08  Andy Estes  <aestes@apple.com>

        [Content Filtering] Load blocked pages more like other error pages are loaded
        https://bugs.webkit.org/show_bug.cgi?id=159485
        <rdar://problem/26014076>

        Reviewed by Brady Eidson.

        * Misc/WebKitErrors.h: Defined WebKitErrorFrameLoadBlockedByContentFilter.
        * Misc/WebKitErrors.m:
        (registerErrors): Registered WebKitErrorDescriptionFrameLoadBlockedByContentFilter.
        * WebCoreSupport/WebFrameLoaderClient.h:
        * WebCoreSupport/WebFrameLoaderClient.mm:
        (WebFrameLoaderClient::blockedByContentFilterError): Returned a ResourceError for WebKitErrorFrameLoadBlockedByContentFilter.

2016-07-08  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r202944.
        https://bugs.webkit.org/show_bug.cgi?id=159570

        caused some tests to crash under GuardMalloc (Requested by
        estes on #webkit).

        Reverted changeset:

        "[Content Filtering] Load blocked pages more like other error
        pages are loaded"
        https://bugs.webkit.org/show_bug.cgi?id=159485
        http://trac.webkit.org/changeset/202944

2016-07-08  Jiewen Tan  <jiewen_tan@apple.com>

        Define DYLD_MACOSX_VERSION_10_12
        https://bugs.webkit.org/show_bug.cgi?id=159525
        <rdar://problem/26250296>

        Reviewed by Brent Fulgham.

        * WebView/WebView.mm:
        (shouldConvertInvalidURLsToBlank):
        Replace 0x000A0C00 with DYLD_MACOSX_VERSION_10_12.

2016-07-07  Beth Dakin  <bdakin@apple.com>

        API Test DoNotLeakWebView.ViewThatLoadsEditableArea times out on macOS Sierra
        https://bugs.webkit.org/show_bug.cgi?id=159532
        -and corresponding-
        rdar://problem/27177179

        Reviewed by Tim Horton.

        * WebView/WebView.mm:
        (-[WebView showCandidates:forString:inRect:forSelectedRange:view:completionHandler:]):
        (-[WebView forceRequestCandidatesForTesting]):
        (-[WebView shouldRequestCandidates]):
        * WebView/WebViewPrivate.h:

2016-07-07  Andy Estes  <aestes@apple.com>

        [Content Filtering] Load blocked pages more like other error pages are loaded
        https://bugs.webkit.org/show_bug.cgi?id=159485
        <rdar://problem/26014076>

        Reviewed by Brady Eidson.

        * Misc/WebKitErrors.h: Defined WebKitErrorFrameLoadBlockedByContentFilter.
        * Misc/WebKitErrors.m:
        (registerErrors): Registered WebKitErrorDescriptionFrameLoadBlockedByContentFilter.
        * WebCoreSupport/WebFrameLoaderClient.h:
        * WebCoreSupport/WebFrameLoaderClient.mm:
        (WebFrameLoaderClient::blockedByContentFilterError): Returned a ResourceError for WebKitErrorFrameLoadBlockedByContentFilter.

2016-07-07  Alex Christensen  <achristensen@webkit.org>

        Use SocketProvider to create WebSocketChannels
        https://bugs.webkit.org/show_bug.cgi?id=158776

        Reviewed by Brent Fulgham.

        * Misc/WebSocketProvider.mm: Copied from Source/WebCore/Modules/websockets/ThreadableWebSocketChannel.cpp.
        (WebSocketProvider::createWebSocketChannel):
        (WebCore::ThreadableWebSocketChannel::create): Deleted.
        * Misc/WebSocketProvider.h:
        * WebView/WebView.mm:
        (-[WebView _commonInitializationWithFrameName:groupName:]):
        (-[WebView initSimpleHTMLDocumentWithStyle:frame:preferences:groupName:]):

2016-07-06  Benjamin Poulain  <bpoulain@apple.com>

        [JSC] Unify how we throw TypeError from C++
        https://bugs.webkit.org/show_bug.cgi?id=159500

        Reviewed by Saam Barati.

        * Plugins/Hosted/ProxyInstance.mm:
        (WebKit::ProxyInstance::invokeMethod):

2016-07-01  Youenn Fablet  <youennf@gmail.com>

        Add a runtime flag for DOM iterators
        https://bugs.webkit.org/show_bug.cgi?id=159300

        Reviewed by Alex Christensen.

        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (-[WebPreferences DOMIteratorEnabled]):
        (-[WebPreferences setDOMIteratorEnabled:]):
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):

2016-06-30  Jiewen Tan  <jiewen_tan@apple.com>

        Create a generic "linked-on-or-after" check for new CSP Rules
        https://bugs.webkit.org/show_bug.cgi?id=159322
        <rdar://problem/27117220>

        Reviewed by Brent Fulgham.

        * WebView/WebView.mm:
        (shouldAllowContentSecurityPolicySourceStarToMatchAnyProtocol):

2016-06-30  Anders Carlsson  <andersca@apple.com>

        Mail crashes on launch at WebCore::PaymentCoordinator::~PaymentCoordinator() + 20
        https://bugs.webkit.org/show_bug.cgi?id=159306
        rdar://problem/27092107

        Reviewed by Tim Horton.

        * WebView/WebView.mm:
        (-[WebView initSimpleHTMLDocumentWithStyle:frame:preferences:groupName:]):
        Create a WebPaymentCoordinatorClient. Remove an unneeded #import.

        (-[WebView _commonInitializationWithFrameName:groupName:]):
        Remove an unneeded #import.

2016-06-27  Anders Carlsson  <andersca@apple.com>

        WebKit::WebPaymentCoordinator leak
        https://bugs.webkit.org/show_bug.cgi?id=159168
        rdar://problem/26929772

        Reviewed by Beth Dakin.

        Update for WebCore changes.

        * WebCoreSupport/WebPaymentCoordinatorClient.h:
        * WebCoreSupport/WebPaymentCoordinatorClient.mm:
        (WebPaymentCoordinatorClient::paymentCoordinatorDestroyed):
        (WebPaymentCoordinatorClient::mainFrameDestroyed): Deleted.

2016-06-27  Tim Horton  <timothy_horton@apple.com>

        REGRESSION (r189052): Clipping occurs when using context menu to Look Up words within the Dictionary app
        https://bugs.webkit.org/show_bug.cgi?id=159184
        <rdar://problem/26370206>

        Reviewed by Beth Dakin.

        * WebView/WebHTMLView.mm:
        (-[WebHTMLView _lookUpInDictionaryFromMenu:]):
        * WebView/WebImmediateActionController.h:
        * WebView/WebImmediateActionController.mm:
        (+[WebImmediateActionController _dictionaryPopupInfoForRange:inFrame:withLookupOptions:indicatorOptions:transition:]):
        (-[WebImmediateActionController _animationControllerForText]):
        (dictionaryPopupInfoForRange): Deleted.
        WebImmediateActionController's code to make a DictionaryPopupInfo and TextIndicator
        from a Range in WebKit1 is much better than WebHTMLView's; use it in both cases.

2016-06-24  Jer Noble  <jer.noble@apple.com>

        Playback controls refer to wrong element when playing multiple items in a page.
        https://bugs.webkit.org/show_bug.cgi?id=159076
        <rdar://problem/26953532>

        Reviewed by Beth Dakin.

        clearPlaybackControlsManager() no longer takes a parameter.

        * WebCoreSupport/WebChromeClient.h:
        * WebCoreSupport/WebChromeClient.mm:
        (WebChromeClient::clearPlaybackControlsManager):
        * WebView/WebView.mm:
        (-[WebView _clearPlaybackControlsManager]): Renamed from _clearPlaybackControlsManagerForMediaElement:.
        * WebView/WebViewInternal.h:

2016-06-23  Alex Christensen  <achristensen@webkit.org>

        Remove unused didCancelAuthenticationChallenge
        https://bugs.webkit.org/show_bug.cgi?id=158819

        Reviewed by David Kilzer.

        * Misc/WebDownload.mm:
        (-[WebDownloadInternal download:didCancelAuthenticationChallenge:]): Deleted.
        * WebCoreSupport/WebFrameLoaderClient.h:
        * WebCoreSupport/WebFrameLoaderClient.mm:
        (WebFrameLoaderClient::dispatchDidCancelAuthenticationChallenge): Deleted.
        * WebView/WebDelegateImplementationCaching.h:
        * WebView/WebView.mm:
        (-[WebView _cacheResourceLoadDelegateImplementations]):

2016-06-23  John Wilander  <wilander@apple.com>

        Enable window.open() for existing versions of Secret Society app
        https://bugs.webkit.org/show_bug.cgi?id=159049
        <rdar://problem/26528349>

        Reviewed by Andy Estes.

        The Secret Society Hidden Mystery app has a broken version check treating iOS 10
        as iOS 1 on iPads. Therefore it believes it can use window.open() in a tap
        handler. We should allow the existing versions of the app to do this to not break
        them.

        * WebView/WebView.mm:
        (shouldAllowWindowOpenWithoutUserGesture):
            Added.
        (shouldConvertInvalidURLsToBlank):
            Changed hex number to constant DYLD_IOS_VERSION_10_0.

2016-06-22  Anders Carlsson  <andersca@apple.com>

        Move the WebKitLegacy Apple Pay code to the open source repository
        https://bugs.webkit.org/show_bug.cgi?id=159035

        Reviewed by Tim Horton.

        * WebCoreSupport/WebPaymentCoordinatorClient.h: Added.
        * WebCoreSupport/WebPaymentCoordinatorClient.mm: Added.
        (WebPaymentCoordinatorClient::WebPaymentCoordinatorClient):
        (WebPaymentCoordinatorClient::~WebPaymentCoordinatorClient):
        (WebPaymentCoordinatorClient::supportsVersion):
        (WebPaymentCoordinatorClient::canMakePayments):
        (WebPaymentCoordinatorClient::canMakePaymentsWithActiveCard):
        (WebPaymentCoordinatorClient::showPaymentUI):
        (WebPaymentCoordinatorClient::completeMerchantValidation):
        (WebPaymentCoordinatorClient::completeShippingMethodSelection):
        (WebPaymentCoordinatorClient::completeShippingContactSelection):
        (WebPaymentCoordinatorClient::completePaymentMethodSelection):
        (WebPaymentCoordinatorClient::completePaymentSession):
        (WebPaymentCoordinatorClient::abortPaymentSession):
        (WebPaymentCoordinatorClient::mainFrameDestroyed):
        * WebKitAdditions.mm: Removed.
        * WebView/WebView.mm:
        (-[WebView _commonInitializationWithFrameName:groupName:]):

2016-06-21  Anders Carlsson  <andersca@apple.com>

        Fix build.

        * Configurations/FeatureDefines.xcconfig:

2016-06-21  Anders Carlsson  <andersca@apple.com>

        Begin moving the Apple Pay code to the open source repository
        https://bugs.webkit.org/show_bug.cgi?id=158998

        Reviewed by Tim Horton.

        * Configurations/FeatureDefines.xcconfig:
        Add ENABLE_APPLE_PAY.

2016-06-20  Simon Fraser  <simon.fraser@apple.com>

        Focus event dispatched in iframe causes parent document to scroll incorrectly
        https://bugs.webkit.org/show_bug.cgi?id=158629
        rdar://problem/26521616

        Reviewed by Tim Horton.
        
        Pass SelectionRevealMode::Reveal in existing code.

        * WebView/WebFrame.mm:
        (-[WebFrame _scrollDOMRangeToVisible:]):
        (-[WebFrame _scrollDOMRangeToVisible:withInset:]):
        (-[WebFrame revealSelectionAtExtent:]):
        * WebView/WebHTMLView.mm:
        (-[WebHTMLView jumpToSelection:]):
        (-[WebHTMLView centerSelectionInVisibleArea:]):

2016-06-21  Amir Alavi  <aalavi@apple.com>

        Upstream WKHTTPCookiesForURL from WebKitSystemInterface to OpenSource
        https://bugs.webkit.org/show_bug.cgi?id=158967

        Reviewed by Brent Fulgham.

        * WebCoreSupport/WebSystemInterface.mm:
        (InitWebCoreSystemInterface): Deleted.

2016-06-20  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r202243.
        https://bugs.webkit.org/show_bug.cgi?id=158972

        Broke Windows build and iOS tests (Requested by ap on
        #webkit).

        Reverted changeset:

        "Focus event dispatched in iframe causes parent document to
        scroll incorrectly"
        https://bugs.webkit.org/show_bug.cgi?id=158629
        http://trac.webkit.org/changeset/202243

2016-06-20  Simon Fraser  <simon.fraser@apple.com>

        Focus event dispatched in iframe causes parent document to scroll incorrectly
        https://bugs.webkit.org/show_bug.cgi?id=158629
        rdar://problem/26521616

        Reviewed by Tim Horton.
        
        Pass SelectionRevealMode::Reveal in existing code.

        * WebView/WebFrame.mm:
        (-[WebFrame _scrollDOMRangeToVisible:]):
        (-[WebFrame _scrollDOMRangeToVisible:withInset:]):
        (-[WebFrame revealSelectionAtExtent:]):
        * WebView/WebHTMLView.mm:
        (-[WebHTMLView jumpToSelection:]):
        (-[WebHTMLView centerSelectionInVisibleArea:]):

2016-06-20  Keith Rollin  <krollin@apple.com>

        Remove RefPtr::release() and change calls sites to use WTFMove()
        https://bugs.webkit.org/show_bug.cgi?id=158369

        Reviewed by Chris Dumez.

        RefPtr::release() releases its managed pointer awkwardly. It's more
        direct and clearer to use WTFMove to transfer ownership of the managed
        pointer.

        As part of this cleanup, also change a lot of explicit data types to
        'auto'.

        * Plugins/Hosted/NetscapePluginHostManager.mm:
        (WebKit::NetscapePluginHostManager::instantiatePlugin):
        * Plugins/Hosted/NetscapePluginInstanceProxy.mm:
        (WebKit::NetscapePluginInstanceProxy::create):
        (WebKit::NetscapePluginInstanceProxy::loadRequest):
        (WebKit::NetscapePluginInstanceProxy::demarshalValueFromArray):
        * WebCoreSupport/WebFrameLoaderClient.mm:
        (-[WebFramePolicyListener receivedPolicyDecision:]):
        * WebCoreSupport/WebSecurityOrigin.mm:
        (-[WebSecurityOrigin initWithURL:]):
        * WebView/WebArchive.mm:
        (-[WebArchive initWithMainResource:subresources:subframeArchives:]):
        (-[WebArchive initWithData:]):
        * WebView/WebDataSource.mm:
        (-[WebDataSource mainResource]):
        * WebView/WebFrame.mm:
        (-[WebFrame _documentFragmentWithNodesAsParagraphs:]):

2016-06-15  Alexey Proskuryakov  <ap@apple.com>

        +[WebHTMLRepresentation supportedMIMETypes] leaks
        https://bugs.webkit.org/show_bug.cgi?id=158683

        Reviewed by Darin Adler.

        The problem occurred when chaining newArrayByConcatenatingArrays calls.

        Also refactored the code to avoid returning NSMutableArrays disguised as NSArrays,
        and removed __unsafe_unretained modifiers that were added in http://trac.webkit.org/r149453
        for no apparent reason.

        * WebView/WebHTMLRepresentation.mm:
        (newArrayWithStrings):
        (+[WebHTMLRepresentation supportedMIMETypes]):
        (+[WebHTMLRepresentation supportedMediaMIMETypes]):
        (+[WebHTMLRepresentation supportedNonImageMIMETypes]):
        (+[WebHTMLRepresentation supportedImageMIMETypes]):
        (+[WebHTMLRepresentation unsupportedTextMIMETypes]):
        (newArrayByConcatenatingArrays): Deleted.

2016-06-15  Dean Jackson  <dino@apple.com>

        RTL <select> forms are misplaced
        https://bugs.webkit.org/show_bug.cgi?id=158810
        <rdar://problem/24847541>

        Reviewed by Eric Carlson.

        AppKit made a change in Sierra that causes popup menus
        to snap to a different point when the system language is RTL.
        We need to be more explicit about what directionality
        we want, and override the location of the popup based
        on the text direction.

        I also made a small tweak to the fudge offsets we use
        in order to make button text and menu text to be
        more consistent.

        Unfortunately since this is just about the location
        of the popup menu, it's unable to be tested in our
        current infrastructure.

        * WebCoreSupport/PopupMenuMac.mm:
        (PopupMenuMac::show):

2016-06-15  Chris Dumez  <cdumez@apple.com>

        Drop some unnecessary header includes
        https://bugs.webkit.org/show_bug.cgi?id=158788

        Reviewed by Alexey Proskuryakov.

        Drop some unnecessary header includes in headers to speed up build time.

        * WebCoreSupport/WebFrameLoaderClient.mm:

2016-06-15  Romain Bellessort  <romain.bellessort@crf.canon.fr>

        Enabling Shadow DOM for all platforms
        https://bugs.webkit.org/show_bug.cgi?id=158738

        Reviewed by Ryosuke Niwa.

        Removed Shadow DOM from options (enabled by default)

        * Configurations/FeatureDefines.xcconfig:
        * WebView/WebPreferences.mm:
        * WebView/WebView.mm:

2016-06-15  Antti Koivisto  <antti@apple.com>

        Vary:Cookie validation doesn't work in private browsing
        https://bugs.webkit.org/show_bug.cgi?id=158616
        <rdar://problem/26755067>

        Reviewed by Andreas Kling.

        * WebCoreSupport/WebFrameNetworkingContext.h:
        (WebFrameNetworkingContext::create):
        * WebCoreSupport/WebFrameNetworkingContext.mm:
        (privateSession):
        (WebFrameNetworkingContext::ensurePrivateBrowsingSession):

            Expose the private browsing session.

        (WebFrameNetworkingContext::destroyPrivateBrowsingSession):
        * WebCoreSupport/WebPlatformStrategies.h:
        * WebCoreSupport/WebPlatformStrategies.mm:
        (WebPlatformStrategies::cookieRequestHeaderFieldValue):

            Implement SessionID version of the function.

        (WebPlatformStrategies::getRawCookies):

2016-06-13  Alex Christensen  <achristensen@webkit.org>

        Add WebSocketProvider stub
        https://bugs.webkit.org/show_bug.cgi?id=158702

        Reviewed by Brady Eidson.

        * Misc/WebSocketProvider.h: Added.
        * WebView/WebView.mm:
        (-[WebView _commonInitializationWithFrameName:groupName:]):
        (-[WebView initSimpleHTMLDocumentWithStyle:frame:preferences:groupName:]):

2016-06-10  Alex Christensen  <achristensen@webkit.org>

        Introduce WTF::UniqueRef
        https://bugs.webkit.org/show_bug.cgi?id=158596

        Reviewed by Brady Eidson.

        * WebView/WebView.mm:
        (-[WebView _commonInitializationWithFrameName:groupName:]):
        (-[WebView initSimpleHTMLDocumentWithStyle:frame:preferences:groupName:]):

2016-06-09  Alex Christensen  <achristensen@webkit.org>

        Clean up EditorClient lifetime
        https://bugs.webkit.org/show_bug.cgi?id=158588

        Reviewed by Anders Carlsson.

        * WebCoreSupport/WebEditorClient.h:
        * WebCoreSupport/WebEditorClient.mm:
        (WebEditorClient::WebEditorClient):
        (WebEditorClient::pageDestroyed): Deleted.
        * WebView/WebView.mm:
        (-[WebView _commonInitializationWithFrameName:groupName:]):
        (-[WebView initSimpleHTMLDocumentWithStyle:frame:preferences:groupName:]):

2016-06-09  Andy Estes  <aestes@apple.com>

        Define printing{Minimum,Maximum}ShrinkFactor in only one place
        https://bugs.webkit.org/show_bug.cgi?id=158580

        Reviewed by Tim Horton.

        * WebView/WebHTMLView.mm: Initialized _WebHTMLViewPrintingMinimumShrinkFactor and
        _WebHTMLViewPrintingMaximumShrinkFactor with PrintContext::minimumShrinkFactor() and
        PrintContext::maximumShrinkFactor() instead of with duplicated float literals.

2016-06-09  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r201810.
        https://bugs.webkit.org/show_bug.cgi?id=158563

        breaks build without ENABLE_WEB_ANIMATION (Requested by
        mcatanzaro on #webkit).

        Reverted changeset:

        "[web-animations] Add Animatable, AnimationEffect,
        KeyframeEffect and Animation interface"
        https://bugs.webkit.org/show_bug.cgi?id=156096
        http://trac.webkit.org/changeset/201810

2016-06-08  Rawinder Singh  <rawinder.singh-webkit@cisra.canon.com.au>

        [web-animations] Add Animatable, AnimationEffect, KeyframeEffect and Animation interface
        https://bugs.webkit.org/show_bug.cgi?id=156096

        Reviewed by Dean Jackson.

        Adds:
        - Setup interface for enabling runtime flag for Web animations through preferences.

        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):
        (-[WebPreferences webAnimationsEnabled]):
        (-[WebPreferences setWebAnimationsEnabled:]):
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):

2016-06-07  David Kilzer  <ddkilzer@apple.com>

        [iOS WK1] Remove unused -_webkit_unescapedQueryValue and -_webkit_queryKeysAndValues NSString category methods
        <https://webkit.org/b/158485>
        <rdar://problem/16960445>

        Reviewed by Dan Bernstein.

        * Misc/WebNSURLExtras.h:
        (-[NSString _webkit_unescapedQueryValue]): Deleted declaration.
        (-[NSString _webkit_queryKeysAndValues]): Deleted declaration.
        * Misc/WebNSURLExtras.mm:
        (-[NSString _webkit_unescapedQueryValue]): Deleted.
        (-[NSString _webkit_queryKeysAndValues]): Deleted.

2016-06-07  Alex Christensen  <achristensen@webkit.org>

        Adopt [PDFView documentScrollView]
        https://bugs.webkit.org/show_bug.cgi?id=158454
        rdar://problem/25875390

        Reviewed by Tim Horton.

        * WebView/PDFViewSPI.h: Added.
        * WebView/WebPDFView.mm:
        (-[WebPDFView _clipViewForPDFDocumentView]):

2016-06-05  Anders Carlsson  <andersca@apple.com>

        Attempt to fix plug-in hangs by adding back empty slots for the removed messages.

        * Plugins/Hosted/WebKitPluginClient.defs:
        * Plugins/Hosted/WebKitPluginHost.defs:

2016-06-04  Anders Carlsson  <andersca@apple.com>

        Remove NPSPI that is no longer used
        https://bugs.webkit.org/show_bug.cgi?id=158384

        Reviewed by Sam Weinig.

        * Configurations/WebKitLegacy.xcconfig:
        * Plugins/Hosted/NetscapePluginHostProxy.mm:
        (WKPCCheckIfAllowedToLoadURL): Deleted.
        (WKPCCancelCheckIfAllowedToLoadURL): Deleted.
        (WKPCResolveURL): Deleted.
        * Plugins/Hosted/NetscapePluginInstanceProxy.h:
        * Plugins/Hosted/NetscapePluginInstanceProxy.mm:
        (WebKit::NetscapePluginInstanceProxy::NetscapePluginInstanceProxy): Deleted.
        (WebKit::NetscapePluginInstanceProxy::checkIfAllowedToLoadURL): Deleted.
        (WebKit::NetscapePluginInstanceProxy::cancelCheckIfAllowedToLoadURL): Deleted.
        (WebKit::NetscapePluginInstanceProxy::checkIfAllowedToLoadURLResult): Deleted.
        (WebKit::NetscapePluginInstanceProxy::resolveURL): Deleted.
        * Plugins/Hosted/WebHostedNetscapePluginView.h:
        * Plugins/Hosted/WebHostedNetscapePluginView.mm:
        (-[WebHostedNetscapePluginView _webPluginContainerCancelCheckIfAllowedToLoadRequest:]): Deleted.
        (-[WebHostedNetscapePluginView _containerCheckResult:contextInfo:]): Deleted.
        * Plugins/Hosted/WebKitPluginClient.defs:
        * Plugins/WebBaseNetscapePluginView.h:
        * Plugins/WebBaseNetscapePluginView.mm:
        (-[WebBaseNetscapePluginView resolvedURLStringForURL:target:]): Deleted.
        * Plugins/WebNetscapeContainerCheckContextInfo.h: Removed.
        * Plugins/WebNetscapeContainerCheckContextInfo.mm: Removed.
        (-[WebNetscapeContainerCheckContextInfo initWithCheckRequestID:callbackFunc:context:]): Deleted.
        (-[WebNetscapeContainerCheckContextInfo checkRequestID]): Deleted.
        (-[WebNetscapeContainerCheckContextInfo callback]): Deleted.
        (-[WebNetscapeContainerCheckContextInfo context]): Deleted.
        * Plugins/WebNetscapeContainerCheckPrivate.h: Removed.
        * Plugins/WebNetscapeContainerCheckPrivate.mm: Removed.
        (browserContainerCheckFuncs): Deleted.
        * Plugins/WebNetscapePluginView.h:
        * Plugins/WebNetscapePluginView.mm:
        (-[WebNetscapePluginView checkIfAllowedToLoadURL:frame:callbackFunc:context:]): Deleted.
        (-[WebNetscapePluginView _containerCheckResult:contextInfo:]): Deleted.
        (-[WebNetscapePluginView cancelCheckIfAllowedToLoadURL:]): Deleted.
        (-[WebNetscapePluginView _webPluginContainerCancelCheckIfAllowedToLoadRequest:]): Deleted.
        (-[WebNetscapePluginView fini]): Deleted.
        (-[WebNetscapePluginView getVariable:value:]): Deleted.
        (-[WebNetscapePluginView resolveURL:forTarget:]): Deleted.
        * Plugins/npapi.mm:
        (WKN_CheckIfAllowedToLoadURL): Deleted.
        (WKN_CancelCheckIfAllowedToLoadURL): Deleted.
        (WKN_ResolveURL): Deleted.

2016-06-04  Anders Carlsson  <andersca@apple.com>

        Temporary build fix. (This function is going away).

        * Plugins/Hosted/NetscapePluginInstanceProxy.mm:
        (WebKit::NetscapePluginInstanceProxy::checkIfAllowedToLoadURLResult): Deleted.
        * Plugins/Hosted/WebKitPluginHost.defs:

2016-06-03  Chris Dumez  <cdumez@apple.com>

        Unreviewed, roll out r196633 as it broke PageCache on iOS for WebKit.org
        <rdar://problem/26521101>

        * WebCoreSupport/WebVisitedLinkStore.mm:
        (WebVisitedLinkStore::removeAllVisitedLinks):
        (WebVisitedLinkStore::removeVisitedLink):
        (WebVisitedLinkStore::addVisitedLinkHash):

2016-06-02  Youenn Fablet  <youenn.fablet@crf.canon.fr>

        Add WebIDL special operation support: serializer
        https://bugs.webkit.org/show_bug.cgi?id=156293

        Reviewed by Darin Adler.

        * Plugins/Hosted/HostedNetscapePluginStream.mm:
        (WebKit::HostedNetscapePluginStream::start):
        * Plugins/WebNetscapePluginStream.mm:
        (WebNetscapePluginStream::start):

2016-05-31  Darin Adler  <darin@apple.com>

        Audit RenderObject casts and fix problems and style issues found
        https://bugs.webkit.org/show_bug.cgi?id=158221

        Reviewed by Chris Dumez.

        * Misc/WebNSPasteboardExtras.mm:
        (imageFromElement): Use auto and tighten the logic a bit.
        (-[NSPasteboard _web_declareAndWriteDragImageForElement:URL:title:archive:source:]):
        Use auto and added a comment about this not using imageFromElement.

        * Plugins/WebBaseNetscapePluginView.mm:
        (-[WebBaseNetscapePluginView _windowClipRect]): Consistently cast to
        RenderEmbeddedObject, which is the class used for renderers for plug-ins.
        (-[WebBaseNetscapePluginView inFlatteningPaint]): Ditto.
        (-[WebBaseNetscapePluginView invalidatePluginContentRect:]): Ditto.
        (-[WebBaseNetscapePluginView actualVisibleRectInWindow]): Ditto.

        * WebCoreSupport/WebFrameLoaderClient.mm:
        (WebFrameLoaderClient::createPlugin): Changed code so it does a null check
        rather than assuming the renderer is non-null.
        (WebFrameLoaderClient::createJavaAppletWidget): Ditto.

2016-05-31  Yusuke Suzuki  <utatane.tea@gmail.com>

        Unreviewed, roll out r201481, r201523: 0.3% regression in Octane code-load
        https://bugs.webkit.org/show_bug.cgi?id=158249

        * WebView/WebPreferencesPrivate.h:

2016-05-27  Chris Dumez  <cdumez@apple.com>

        callOnMainThread() should not copy captured lambda variables
        https://bugs.webkit.org/show_bug.cgi?id=158166

        Reviewed by Brady Eidson.

        callOnMainThread() should not copy captured lambda variables. This 
        function is usually called cross-thread with a lambda and copying
        the lambda (and its captured variables) can lead to thread-safety
        issues.

        This patch updates callOnMainThread() to take a NoncopyableFunction&&
        in parameter instead of a std::function. The call sites of
        callOnMainThread() have also been updated to use C++14's lambda
        capture with initializer.

        * Storage/WebDatabaseManagerClient.mm:
        (DidModifyOriginData::dispatchToMainThread):
        (DidModifyOriginData::DidModifyOriginData): Deleted.
        * Storage/WebStorageTrackerClient.mm:
        (WebStorageTrackerClient::dispatchDidModifyOrigin):

2016-05-27  Caitlin Potter  <caitp@igalia.com>

        [JSC] implement async functions proposal
        https://bugs.webkit.org/show_bug.cgi?id=156147

        Reviewed by Yusuke Suzuki.

        * WebView/WebPreferencesPrivate.h:

2016-05-26  Darin Adler  <darin@apple.com>

        Media queries and platform screen modernization and streamlining
        https://bugs.webkit.org/show_bug.cgi?id=158067

        Reviewed by Alex Christensen.

        * WebView/WebFrame.mm:
        (-[WebFrame _dragSourceEndedAt:operation:]): Updated to use the new version of
        globalPoint, which returns an NSPoint.

2016-05-26  Myles C. Maxfield  <mmaxfield@apple.com>

        Build fix

        Rubber stamped by Lucas Forschler.

        * Configurations/DebugRelease.xcconfig:

2016-05-24  Beth Dakin  <bdakin@apple.com>

        Candidates should work with input methods
        https://bugs.webkit.org/show_bug.cgi?id=158042
        -and corresponding-
        rdar://problem/26205228

        Reviewed by Tim Horton.

        * WebView/WebHTMLView.mm:
        * WebView/WebView.mm:
        (-[WebView candidateList]):
        * WebView/WebViewInternal.h:

2016-05-22  Brady Eidson  <beidson@apple.com>

        Move to C++14.
        https://bugs.webkit.org/show_bug.cgi?id=157948

        Reviewed by Michael Catanzaro.

        * Configurations/Base.xcconfig:

2016-05-20  Enrica Casucci  <enrica@apple.com>

        Drag cannot start if no drag data or custom data is available in the Pasteboard.
        https://bugs.webkit.org/show_bug.cgi?id=157911
        rdar://problem/24577706

        Reviewed by Tim Horton.

        We need to make sure there is always one item in common between source and target
        of the drag and drop operation.

        * WebView/WebHTMLView.mm:
        (-[WebHTMLView dragImage:at:offset:event:pasteboard:source:slideBack:]):

2016-05-19  Enrica Casucci  <enrica@apple.com>

        Drag cannot start if no drag data is available in the Pasteboard.
        https://bugs.webkit.org/show_bug.cgi?id=157911
        rdar://problem/24577706

        Reviewed by Tim Horton.

        * WebView/WebHTMLView.mm:
        (+[WebHTMLView _dummyPasteboardType]):
        (-[WebHTMLView dragImage:at:offset:event:pasteboard:source:slideBack:]):
        * WebView/WebHTMLViewPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _registerDraggedTypes]):

2016-05-19  Jer Noble  <jer.noble@apple.com>

        [IOS] Add setting to allow playback to continue inline after exiting fullscreen.
        https://bugs.webkit.org/show_bug.cgi?id=157912

        Reviewed by Eric Carlson.

        Add a preference to control whether media should be allowed to continue playing inline when
        exiting fullscreen.

        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):
        (-[WebPreferences allowsInlineMediaPlaybackAfterFullscreen]):
        (-[WebPreferences setAllowsInlineMediaPlaybackAfterFullscreen:]):
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):

2016-05-18  Brady Eidson  <beidson@apple.com>

        Modern IDB: Make TestRunner.clearAllDatabases also delete IndexedDB databases (once doing so is supported).
        https://bugs.webkit.org/show_bug.cgi?id=157823

        Reviewed by Alex Christensen.

        * Storage/WebDatabaseManager.mm:
        (-[WebDatabaseManager deleteAllIndexedDatabases]):
        * Storage/WebDatabaseManagerPrivate.h:

2016-05-17  Beth Dakin  <bdakin@apple.com>

        Make handleAcceptedCandidate a public function
        https://bugs.webkit.org/show_bug.cgi?id=157763
        -and corresponding-
        rdar://problem/26206397

        Reviewed by Tim Horton.

        This patch re-names handleAcceptedCandidate to 
        handleAcceptedCandidateWithSoftSpaces. The function now takes a 
        WebCore::TextCheckingResult instead of an NSTextCheckingResult and it can be 
        called from outside of WebEditorClient.

        * WebCoreSupport/WebEditorClient.h:
        * WebCoreSupport/WebEditorClient.mm:
        (WebEditorClient::handleRequestedCandidates):
        (WebEditorClient::handleAcceptedCandidateWithSoftSpaces):
        (textCheckingResultFromNSTextCheckingResult): Deleted.
        (WebEditorClient::handleAcceptedCandidate): Deleted.

        Move showCandidates to WebViewPrivate so that it can be overridden by a test.
        * WebView/WebViewInternal.h:
        * WebView/WebViewPrivate.h:

2016-05-17  Dean Jackson  <dino@apple.com>

        Remove ES6_GENERATORS flag
        https://bugs.webkit.org/show_bug.cgi?id=157815
        <rdar://problem/26332894>

        Reviewed by Geoffrey Garen.

        This flag isn't needed. Generators are enabled everywhere and
        part of a stable specification.

        * Configurations/FeatureDefines.xcconfig:

2016-05-17  Filip Pizlo  <fpizlo@apple.com>

        WTF should know about Language
        https://bugs.webkit.org/show_bug.cgi?id=157756

        Reviewed by Geoffrey Garen.

        Rewires a bunch of includes/imports.

        * WebCoreSupport/PopupMenuMac.mm:
        * WebCoreSupport/WebChromeClient.mm:
        * WebCoreSupport/WebFrameLoaderClient.mm:
        * WebCoreSupport/WebGeolocationClient.mm:
        * WebCoreSupport/WebNotificationClient.mm:
        * WebCoreSupport/WebPlatformStrategies.mm:
        * WebCoreSupport/WebUserMediaClient.mm:
        * WebCoreSupport/WebVisitedLinkStore.mm:
        * WebView/WebHTMLView.mm:

2016-05-13  Enrica Casucci  <enrica@apple.com>

        Remove unused initializer for WebEvent on iOS.
        https://bugs.webkit.org/show_bug.cgi?id=157689

        Reviewed by Anders Carlsson.

        Removing use of characterSet property.

        * WebView/WebHTMLView.mm:
        (-[WebHTMLView _handleEditingKeyEvent:]):


2016-05-13  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r200894.
        https://bugs.webkit.org/show_bug.cgi?id=157695

        This change broke the iOS build (Requested by ryanhaddad on
        #webkit).

        Reverted changeset:

        "Remove unused initializer for WebEvent on iOS."
        https://bugs.webkit.org/show_bug.cgi?id=157689
        http://trac.webkit.org/changeset/200894

2016-05-13  Enrica Casucci  <enrica@apple.com>

        Remove unused initializer for WebEvent on iOS.
        https://bugs.webkit.org/show_bug.cgi?id=157689

        Reviewed by Anders Carlsson.

        Removing use of characterSet property.

        * WebView/WebHTMLView.mm:
        (-[WebHTMLView _handleEditingKeyEvent:]):

2016-05-13  Beth Dakin  <bdakin@apple.com>

        Build fix.

        * WebView/WebView.mm:

2016-05-13  Beth Dakin  <bdakin@apple.com>

        Add dyldSPI.h for linked on or after checks, and add one for link preview
        https://bugs.webkit.org/show_bug.cgi?id=157401
        -and corresponding-
        rdar://problem/26253396

        Reviewed by Darin Adler.

        This patch removes DynamicLinkerSPI.h and replaces it with 
        wtf/spi/darwin/dyldSPI.h

        * WebView/WebView.mm:

2016-05-13  Tina Liu  <iting_liu@apple.com>

        Revert r199691.
        https://bugs.webkit.org/show_bug.cgi?id=157645
        <rdar://problem/26235373>

        Reviewed by Darin Adler.

        * WebCoreSupport/WebPlatformStrategies.h:
        * WebCoreSupport/WebPlatformStrategies.mm:
        (WebPlatformStrategies::setPrivateBrowsingPluginLoadClientPolicy): Deleted.

2016-05-12  Jiewen Tan  <jiewen_tan@apple.com>

        Unreviewed build fix for r200799.

        * WebView/WebView.mm:

2016-05-12  Jiewen Tan  <jiewen_tan@apple.com>

        REGRESSION (r199313): ICBC app: text field In the webview is not tappable
        https://bugs.webkit.org/show_bug.cgi?id=157396
        <rdar://problem/25931513>

        Reviewed by David Kilzer.

        Add a quirk for WebKit1 apps.

        * WebView/WebView.mm:
        (shouldConvertInvalidURLsToBlank):
        (-[WebView _preferencesChanged:]):

2016-05-12  Beth Dakin  <bdakin@apple.com>

        WebKitAdditions needs to be notified before the WebView is dealloc'd
        https://bugs.webkit.org/show_bug.cgi?id=157633
        -and corresponding-
        rdar://problem/26134539

        Reviewed by Anders Carlsson.

        * WebView/WebView.mm:
        (-[WebView dealloc]):
        * WebView/WebViewInternal.h:

2016-05-12  Konstantin Tokarev  <annulen@yandex.ru>

        Use reference instead of pointer in FrameLoaderClient::saveViewStateToItem.
        https://bugs.webkit.org/show_bug.cgi?id=157624

        Reviewed by Darin Adler.

        * WebCoreSupport/WebFrameLoaderClient.h:
        * WebCoreSupport/WebFrameLoaderClient.mm:
        (WebFrameLoaderClient::saveViewStateToItem):
        * WebView/WebFrame.mm:
        (-[WebFrame _saveViewState]):

2016-05-12  Csaba OsztrogonÃ¡c  <ossy@webkit.org>

        Remove ENABLE(ES6_ARROWFUNCTION_SYNTAX) guards
        https://bugs.webkit.org/show_bug.cgi?id=157564

        Reviewed by Darin Adler.

        * Configurations/FeatureDefines.xcconfig:

2016-05-11  Chris Dumez  <cdumez@apple.com>

        Update Node::appendChild() / replaceChild() / removeChild() / insertBefore() to take references instead of pointers
        https://bugs.webkit.org/show_bug.cgi?id=157556

        Reviewed by Darin Adler.

        * WebView/WebFrame.mm:
        (-[WebFrame _documentFragmentWithNodesAsParagraphs:]):

2016-05-10  Shaw rich  <richshaw@126.com>

        [OS X] Compatible with gnu sed grammar due to compile error with gnu sed
        https://bugs.webkit.org/show_bug.cgi?id=157526

        Reviewed by Darin Adler.

        * MigrateHeaders.make:

2016-05-10  Simon Fraser  <simon.fraser@apple.com>

        [iOS WK1] text autosizing was on for all layout tests
        https://bugs.webkit.org/show_bug.cgi?id=157541

        Reviewed by Tim Horton.

        Make sure that we transfer the WK1 text autosizing preference to Settings.

        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):

2016-05-09  Tim Horton  <timothy_horton@apple.com>

        [WebKit1] Invoking a link preview on a complex link (e.g. an image) results in an empty TextIndicator
        https://bugs.webkit.org/show_bug.cgi?id=157497
        <rdar://problem/25872773>

        Reviewed by Anders Carlsson.

        * WebView/WebImmediateActionController.mm:
        (-[WebImmediateActionController _defaultAnimationController]):
        r198578 fixed this for WebKit2, but forgot about WebKit1.

2016-05-08  Myles C. Maxfield  <mmaxfield@apple.com>

        [OS X] Migrate our Font classes entirely off of NSFont
        https://bugs.webkit.org/show_bug.cgi?id=157464

        Reviewed by Darin Adler.

        * WebCoreSupport/PopupMenuMac.mm:
        (PopupMenuMac::populate):
        (PopupMenuMac::show):
        * WebView/WebHTMLView.mm:
        (fontNameForDescription):
        (-[WebHTMLView _addToStyle:fontA:fontB:]):

2016-05-06  Joseph Pecoraro  <pecoraro@apple.com>

        Rename HitTestRequest DisallowShadowContent to DisallowUserAgentShadowContent
        https://bugs.webkit.org/show_bug.cgi?id=157447

        Reviewed by Ryosuke Niwa.

        * WebView/WebFrame.mm:
        (-[WebFrame elementAtPoint:]):
        * WebView/WebHTMLView.mm:
        (-[WebHTMLView elementAtPoint:allowShadowContent:]):

2016-05-06  Simon Fraser  <simon.fraser@apple.com>

        Enable IOS_TEXT_AUTOSIZING on Mac and make it testable
        https://bugs.webkit.org/show_bug.cgi?id=157432
        rdar://problem/16406720

        Reviewed by Dean Jackson.

        Enable IOS_TEXT_AUTOSIZING on Mac so it can be tested.

        Make the setTextAutosizingEnabled() Setting work, and plumb it through WK1 and WK2
        preferences for WTR and DRT. Make textAutosizingWindowSizeOverride() work, for layout tests.
        These two settings are shared with TEXT_AUTOSIZING.

        Add a TextAutosizing log channel, which is useful for generated -expected.html results.

        Move adjustComputedFontSizesOnBlocks() and related code from RenderObject to RenderElement
        without changes.

        An implication of this set of changes is that the way clients enable text autosizing
        has changed. Previously, they set the "MinimumZoomFontSize" preference to 0.
        Settings::defaultMinimumZoomFontSize() used to do this in order to enable text autosizing
        on iPhone only, not iPad.

        Now the preferred technique is to leave minimumZoomFontSize alone, and to use textAutosizingEnabled()
        instead. Settings::defaultTextAutosizingEnabled() now does the check for iPhone.

        UIWebView calls WebKitGetMinimumZoomFontSize() to setup the default minimum font zoom size,
        which will now always return 15, but had no other code that toggled this. So it's safe to just rely
        on Settings::defaultTextAutosizingEnabled() doing the right thing for iPhone/iPad.

        * Configurations/FeatureDefines.xcconfig:
        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):
        (-[WebPreferences _setTextAutosizingEnabled:]):
        (-[WebPreferences _textAutosizingEnabled]):
        * WebView/WebPreferencesPrivate.h:

2016-05-06  Dean Jackson  <dino@apple.com>

        Regions, Shapes and Tracks don't need runtime features
        https://bugs.webkit.org/show_bug.cgi?id=157426
        <rdar://problem/26146262>

        Reviewed by Simon Fraser.

        The following RuntimeEnabledFeatures can be removed since
        we have no need to disable them (they are stable and have
        shipped for a while):
        - CSS Regions
        - CSS Shapes
        - Media tracks

        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]): Deleted.
        (-[WebPreferences cssRegionsEnabled]): Deleted.
        (-[WebPreferences setCSSRegionsEnabled:]): Deleted.
        (-[WebPreferences cssCompositingEnabled]): Deleted.
        (-[WebPreferences setCSSCompositingEnabled:]): Deleted.
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]): Deleted.

2016-05-06  Daniel Bates  <dabates@apple.com>

        Remove workaround for Apple Internal bots
        <rdar://problem/25989808>

        Reverts the workaround added in r200211 as it is no longer needed.

        * WebView/WebPDFView.h:

2016-05-02  Daniel Bates  <dabates@apple.com>

        CSP: Add workaround for XtraMath
        https://bugs.webkit.org/show_bug.cgi?id=157252

        Reviewed by Andy Estes.

        * WebView/WebView.mm:
        (shouldAllowContentSecurityPolicySourceStarToMatchAnyProtocol): Allow * to match any protocol for
        applicable versions of app XtraMath.

2016-05-02  Daniel Bates  <dabates@apple.com>

        DatabaseTracker::closeAllDatabases calls Database::close from the wrong thread
        https://bugs.webkit.org/show_bug.cgi?id=147672
        <rdar://problem/22357464>

        Reviewed by Brady Eidson.

        Update the background assertion expiration callback to call DatabaseTracker::closeAllDatabases()
        with CurrentQueryBehavior::Interrupt so that we abort a long running query and close the database
        immediately to avoid holding a locked file when the process is suspended.

        * Storage/WebDatabaseManager.mm:
        (+[WebDatabaseManager startBackgroundTask]):

2016-04-29  Dean Jackson  <dino@apple.com>

        RTL <select> popup menu is in the wrong location
        https://bugs.webkit.org/show_bug.cgi?id=157159
        <rdar://problem/25894451>

        Reapply http://trac.webkit.org/changeset/200217
        but with changes that will allow it to build on Yosemite.

        * WebCoreSupport/PopupMenuMac.mm:
        (PopupMenuMac::show):

2016-04-29  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r200217.
        https://bugs.webkit.org/show_bug.cgi?id=157183

        This change broke the Yosemite build. (Requested by ryanhaddad
        on #webkit).

        Reverted changeset:

        "RTL <select> popup menu is in the wrong location"
        https://bugs.webkit.org/show_bug.cgi?id=157159
        http://trac.webkit.org/changeset/200217

2016-04-28  Dean Jackson  <dino@apple.com>

        RTL <select> popup menu is in the wrong location
        https://bugs.webkit.org/show_bug.cgi?id=157159
        <rdar://problem/25894451>

        Reviewed by Simon Fraser.

        Make sure both the NSPopupMenuCell and the NSPopupMenu take
        the text direction into account, and offset the position
        of the menu slightly if we're in RTL mode.

        Unfortunately our test infrastructure is unable to exercise
        this because it runs without a window, and the popup menu
        is not captured in the screenshot.

        * WebCoreSupport/PopupMenuMac.mm:
        (PopupMenuMac::show):

2016-04-28  Manuel Rego Casasnovas  <rego@igalia.com>

        [css-grid] Add CSS Grid Layout runtime flag
        https://bugs.webkit.org/show_bug.cgi?id=157134

        Reviewed by Simon Fraser.

        Add CSS Grid Layout runtime flag based on preferences,
        enabled by default.

        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):
        (-[WebPreferences isCSSGridLayoutEnabled]):
        (-[WebPreferences setCSSGridLayoutEnabled:]):
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):

2016-04-28  Daniel Bates  <dabates@apple.com>

        Another fix for the Apple Internal OS X build
        <rdar://problem/25989808>

        Reviewed by Anders Carlsson.

        * WebView/WebPDFView.h:

2016-04-28  Daniel Bates  <dabates@apple.com>

        Fix the Apple Internal OS X build

        * WebView/WebPDFView.h: Import PDFKit for definition of protocol PDFViewDelegate.
        Forward declare protocol PDFViewDelegate as appropriate. Mark WebPDFView as implementing
        protocol PDFViewDelegate.
        * WebView/WebPDFView.mm: Move import of PDFKit from here to the header.

2016-04-27  Daniel Bates  <dabates@apple.com>

        CSP: Add app-specific workaround for Ecobee and Quora
        https://bugs.webkit.org/show_bug.cgi?id=157005
        <rdar://problem/25560776>

        Reviewed by Brent Fulgham.

        * Misc/WebKitVersionChecks.h:
        * WebView/WebView.mm:
        (shouldAllowContentSecurityPolicySourceStarToMatchAnyProtocol): Added.
        (-[WebView _preferencesChanged:]): Enable setting allowContentSecurityPolicySourceStarToMatchAnyProtocol
        if applicable.

2016-04-26  Joseph Pecoraro  <pecoraro@apple.com>

        Uncaught Exception: SecurityError: DOM Exception 18: An attempt was made to break through the security policy of the user agent.
        https://bugs.webkit.org/show_bug.cgi?id=156991
        <rdar://problem/25913475>

        Reviewed by Timothy Hatcher.

        * WebCoreSupport/WebInspectorClient.mm:
        (-[WebInspectorWindowController init]):
        Apply the same universal file access to WebKit1 Web Inspector views that
        we apply to WebKit2 views. Explicitly always allow access to storage
        for Web Inspector content just in case as we already allow universal
        file access.

2016-04-26  Beth Dakin  <bdakin@apple.com>

        Check to make sure shouldRequestCandidates() before requesting candidates
        https://bugs.webkit.org/show_bug.cgi?id=157038
        -and corresponding-
        rdar://problem/25910418

        Reviewed by Tim Horton.

        This patch limits requesting and showing candidates to cases where 
        shouldRequestCandidates() is true. This patch also caches the sequence number 
        returned by [NSSpellChecker requestCandidatesForSelectedRange:] to make sure 
        it is equal to the sequence number sent to the callback handler so that we do 
        not show candidates for old requests.

        * WebCoreSupport/WebEditorClient.h:
        * WebCoreSupport/WebEditorClient.mm:
        (WebEditorClient::requestCandidatesForSelection):
        (WebEditorClient::handleRequestedCandidates):
        * WebView/WebView.mm:
        (-[WebView showCandidates:forString:inRect:forSelectedRange:view:completionHandler:]):
        (-[WebView shouldRequestCandidates]):
        * WebView/WebViewInternal.h:

2016-04-25  Ryosuke Niwa  <rniwa@webkit.org>

        Remove the build flag for template elements
        https://bugs.webkit.org/show_bug.cgi?id=157022

        Reviewed by Daniel Bates.

        * Configurations/FeatureDefines.xcconfig:

2016-04-25  Myles C. Maxfield  <mmaxfield@apple.com>

        [Cocoa] Guarantee FontPlatformData's m_cgFont is never nullptr
        https://bugs.webkit.org/show_bug.cgi?id=156929

        Reviewed by Darin Adler.

        * Misc/WebKitNSStringExtras.mm:
        (-[NSString _web_drawAtPoint:font:textColor:allowingFontSmoothing:]): Drawing
        a string with a null font shouldn't do anything.
        * Misc/WebStringTruncator.mm: We can't truncate a string if we don't have a font
        to use.
        (+[WebStringTruncator centerTruncateString:toWidth:]):
        (+[WebStringTruncator centerTruncateString:toWidth:withFont:]):
        (+[WebStringTruncator rightTruncateString:toWidth:withFont:]):
        (+[WebStringTruncator widthOfString:font:]):

2016-04-25  Beth Dakin  <bdakin@apple.com>

        WebEditorClient should properly write to m_rangeForCandidates
        https://bugs.webkit.org/show_bug.cgi?id=157003
        -and corresponding-
        rdar://problem/25910418

        Reviewed by Tim Horton.

        Actually write to m_rangeForCandidates instead of declaring a local variable 
        of the same name. :-/
        * WebCoreSupport/WebEditorClient.mm:
        (WebEditorClient::requestCandidatesForSelection):

2016-04-23  Andy Estes  <aestes@apple.com>

        Fix issues found by the clang static analyzer
        https://bugs.webkit.org/show_bug.cgi?id=156956

        Reviewed by Alexey Proskuryakov.

        * WebView/WebDeviceOrientationProviderMock.mm:
        (-[WebDeviceOrientationProviderMock dealloc]): [super dealloc] should be called last.

2016-04-21  Tim Horton  <timothy_horton@apple.com>

        Fix the iOS build: WAKView may not respond to drawLayer:inContext:
        https://bugs.webkit.org/show_bug.cgi?id=156879
        <rdar://problem/25772661>

        Reviewed by Beth Dakin.

        * WebView/WebHTMLView.mm:
        WebHTMLView on iOS never uses drawLayer:inContext:, and WAKView
        doesn't implement it, so this would have thrown an exception
        if called, anyway. Fix the build with stricter CA protocols.

2016-04-21  Jer Noble  <jer.noble@apple.com>

        [WK1] Add WebPlaybackSession support to WebKit
        https://bugs.webkit.org/show_bug.cgi?id=156854

        Reviewed by Beth Dakin.

        Add support for WebPlaybackSession and the ChromeClient methods setUpPlaybackControlsManager() and
        clearPlaybackControlsManager() to WebKit.

        * WebCoreSupport/WebChromeClient.h:
        * WebCoreSupport/WebChromeClient.mm:
        (WebChromeClient::setUpPlaybackControlsManager):
        (WebChromeClient::clearPlaybackControlsManager):
        * WebView/WebView.mm:
        (-[WebView _hasActiveVideoForControlsInterface]):
        (-[WebView _setUpPlaybackControlsManagerForMediaElement:]):
        (-[WebView _clearPlaybackControlsManagerForMediaElement:]):
        * WebView/WebViewData.h:
        * WebView/WebViewData.mm:
        * WebView/WebViewInternal.h:

2016-04-21  Anders Carlsson  <andersca@apple.com>

        Stop using ApplicationCacheStorage::singleton() in WebKitLegacy
        https://bugs.webkit.org/show_bug.cgi?id=156859

        Reviewed by Tim Horton.

        * WebCoreSupport/WebApplicationCache.mm:
        (+[WebApplicationCache initializeWithBundleIdentifier:]):
        Change this to just store the bundle identifier.

        (applicationCacheBundleIdentifier):
        Helper function that returns the bundle identifier for the app cache.

        (applicationCachePath):
        Return the application cache path.

        (webApplicationCacheStorage):
        Create a new ApplicationCacheStorage object.

        * WebView/WebView.mm:
        (-[WebView _commonInitializationWithFrameName:groupName:]):
        (-[WebView initSimpleHTMLDocumentWithStyle:frame:preferences:groupName:]):
        Set pageConfiguration.applicationCacheStorage to webApplicationCacheStorage().

        (WebKitInitializeApplicationCachePathIfNecessary): Deleted.

2016-04-21  Beth Dakin  <bdakin@apple.com>

        showCandidates() should take a range and the string should be the whole 
        paragraph
        https://bugs.webkit.org/show_bug.cgi?id=156813
        -and corresponding-
        rdar://problem/25760533

        Reviewed by Tim Horton.

        Cache the range and the paragraph since we compute them in 
        requestCandidatesForSelection, and then we can use them again in 
        handleRequestedCandidates.
        * WebCoreSupport/WebEditorClient.h:
        * WebCoreSupport/WebEditorClient.mm:
        (WebEditorClient::requestCandidatesForSelection):
        (WebEditorClient::handleRequestedCandidates):
        * WebView/WebView.mm:
        (-[WebView updateWebViewAdditions]):
        (-[WebView showCandidates:forString:inRect:forSelectedRange:view:completionHandler:]):
        (-[WebView showCandidates:forString:inRect:view:completionHandler:]): Deleted.
        * WebView/WebViewInternal.h:

2016-04-21  Chris Dumez  <cdumez@apple.com>

        Drop [UsePointersEvenForNonNullableObjectArguments] from Range
        https://bugs.webkit.org/show_bug.cgi?id=156805

        Reviewed by Youenn Fablet.

        * WebView/WebFrame.mm:
        (-[WebFrame _smartDeleteRangeForProposedRange:]):

2016-04-20  Brady Eidson  <beidson@apple.com>

        Modern IDB (Workers): Enable INDEXED_DATABASE_IN_WORKERS compile time flag, but disabled in RuntimeEnabledFeatures.
        https://bugs.webkit.org/show_bug.cgi?id=156782

        Reviewed by Alex Christensen.

        * Configurations/FeatureDefines.xcconfig:

2016-04-18  Anders Carlsson  <andersca@apple.com>

        Fix build with newer versions of clang.
        rdar://problem/25749769

        * WebCoreSupport/WebContextMenuClient.mm:
        * WebView/WebHTMLView.mm:
        Forward declare some AppKit IPI.

2016-04-18  Tina Liu  <iting_liu@apple.com>

        Overrode a virtual function of WebCore::PluginStrategy
        https://bugs.webkit.org/show_bug.cgi?id=156540

        Reviewed by Anders Carlsson.

        * WebCoreSupport/WebPlatformStrategies.h:
        * WebCoreSupport/WebPlatformStrategies.mm:
        (WebPlatformStrategies::setPrivateBrowsingPluginLoadClientPolicy):

2016-04-18  Brent Fulgham  <bfulgham@apple.com>

        CSP: Remove stubs for dynamically-added favicons (via link rel="icon")
        https://bugs.webkit.org/show_bug.cgi?id=153151
        <rdar://problem/24383176>

        Reviewed by Darin Adler.

        Remove the unused dynamic favicon code and tests.

        * WebCoreSupport/WebFrameLoaderClient.h:
        * WebCoreSupport/WebFrameLoaderClient.mm:
        (WebFrameLoaderClient::dispatchDidChangeIcons): Deleted.

2016-04-15  Darin Adler  <darin@apple.com>

        Reduce use of Deprecated::ScriptXXX classes
        https://bugs.webkit.org/show_bug.cgi?id=156632

        Reviewed by Alex Christensen.

        * WebView/WebFrame.mm:
        (-[WebFrame _stringByEvaluatingJavaScriptFromString:forceUserGesture:]): Use references instead
        of pointers.
        (-[WebFrame _stringByEvaluatingJavaScriptFromString:withGlobalObject:inScriptWorld:]): Updated
        since return value is a JSValue.
        * WebView/WebView.mm:
        (-[WebView aeDescByEvaluatingJavaScriptFromString:]): Ditto.

2016-04-14  Brent Fulgham  <bfulgham@apple.com>

        Make <a download> a runtime enabled option
        https://bugs.webkit.org/show_bug.cgi?id=156583
        <rdar://problem/25733449>

        Reviewed by Alex Christensen.

        Add a download attribute runtime flag based on preferences.
        Disable the download attribute by default.

        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):
        (-[WebPreferences setFetchAPIEnabled:]):
        (-[WebPreferences downloadAttributeEnabled]):
        (-[WebPreferences setDownloadAttributeEnabled:]):
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged]): Set the runtime flag properly
        based on the user preferences.

2016-04-09  Gavin Barraclough  <barraclough@apple.com>

        WebKit should adopt journal_mode=wal for all SQLite databases.
        https://bugs.webkit.org/show_bug.cgi?id=133496

        Reviewed by Darin Adler.

        * Storage/WebDatabaseManagerPrivate.h:
            - renamed deleteAllDatabases -> deleteAllDatabasesImmediately.

2016-04-05  Oliver Hunt  <oliver@apple.com>

        Remove compile time define for SEPARATED_HEAP
        https://bugs.webkit.org/show_bug.cgi?id=155508

        Reviewed by Mark Lam.

        * Configurations/FeatureDefines.xcconfig:

2016-04-08  Sam Weinig  <sam@webkit.org>

        Remove support for custom target picker actions
        <rdar://problem/24987783>
        https://bugs.webkit.org/show_bug.cgi?id=156434

        Reviewed by Eric Carlson.

        This mostly entailed rolling out r197429 and r197569.

        * WebCoreSupport/WebChromeClient.h:
        * WebCoreSupport/WebChromeClient.mm:
        (WebChromeClient::removePlaybackTargetPickerClient):
        (WebChromeClient::showPlaybackTargetPicker):
        * WebView/WebMediaPlaybackTargetPicker.h:
        * WebView/WebMediaPlaybackTargetPicker.mm:
        (WebMediaPlaybackTargetPicker::removePlaybackTargetPickerClient):
        (WebMediaPlaybackTargetPicker::showPlaybackTargetPicker):
        (WebMediaPlaybackTargetPicker::playbackTargetPickerClientStateDidChange):
        (WebMediaPlaybackTargetPicker::setShouldPlayToPlaybackTarget):
        (WebMediaPlaybackTargetPicker::invalidate):
        (WebMediaPlaybackTargetPicker::customPlaybackActionSelected): Deleted.
        * WebView/WebView.mm:
        (-[WebView _showPlaybackTargetPicker:location:hasVideo:]):
        (-[WebView _playbackTargetPickerClientStateDidChange:state:]):

2016-04-07  Joseph Pecoraro  <pecoraro@apple.com>

        Remove ENABLE(ENABLE_ES6_CLASS_SYNTAX) guards
        https://bugs.webkit.org/show_bug.cgi?id=156384

        Reviewed by Ryosuke Niwa.

        * Configurations/FeatureDefines.xcconfig:

2016-04-07  Brian Burg  <bburg@apple.com>

        CookieJar should support adding synthetic cookies for developer tools
        https://bugs.webkit.org/show_bug.cgi?id=156091
        <rdar://problem/25581340>

        Reviewed by Timothy Hatcher.

        * WebCoreSupport/WebPlatformStrategies.h:
        * WebCoreSupport/WebPlatformStrategies.mm:
        (WebPlatformStrategies::addCookie):
        Add new method override.

2016-04-06  Alex Christensen  <achristensen@webkit.org>

        Fix CMake DumpRenderTree
        https://bugs.webkit.org/show_bug.cgi?id=156305

        Reviewed by Daniel Bates.

        * WebKitPrefix.h:

2016-04-05  Beth Dakin  <bdakin@apple.com>

        Make requestCandidatesForSelection available on any EditorClient
        https://bugs.webkit.org/show_bug.cgi?id=156253
        -and corresponding-
        rdar://problem/24661147

        Reviewed by Dean Jackson.

        * WebCoreSupport/WebEditorClient.h:

2016-04-05  Youenn Fablet  <youenn.fablet@crf.canon.fr>

        [Fetch API] Add a runtime flag to fetch API and related constructs
        https://bugs.webkit.org/show_bug.cgi?id=156113
 
        Reviewed by Alex Christensen.

        Add a fetch API runtime flag based on preferences.
        Disable fetch API by default.
 
        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):
        (-[WebPreferences setCustomElementsEnabled:]):
        (-[WebPreferences fetchAPIEnabled]):
        (-[WebPreferences setFetchAPIEnabled:]):
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):
        (-[WebView preferencesIdentifier]):
        (-[WebView setUIDelegate:]):

2016-04-05  Antoine Quint  <graouts@apple.com>

        [WebGL2] Turn the ENABLE_WEBGL2 flag on
        https://bugs.webkit.org/show_bug.cgi?id=156061
        <rdar://problem/25463193>

        Reviewed by Alex Christensen.

        * Configurations/FeatureDefines.xcconfig:

2016-04-05  Antoine Quint  <graouts@apple.com>

        [WebGL2] Allow enabling WebGL2 with a runtime flag
        https://bugs.webkit.org/show_bug.cgi?id=156166
        <rdar://problem/25526929>

        Set the WebGL2 runtime flag based on preferences, disabled by default.

        Reviewed by Dean Jackson.

        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):
        (-[WebPreferences webGL2Enabled]):
        (-[WebPreferences setWebGL2Enabled:]):
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):

2016-04-01  Alex Christensen  <achristensen@webkit.org>

        Compile DumpRenderTree with CMake on Mac
        https://bugs.webkit.org/show_bug.cgi?id=156088

        Reviewed by Brent Fulgham.

        * Misc/WebKit.h:
        Alphabetize headers.

2016-03-31  Jeremy Jones  <jeremyj@apple.com>

        mediaShouldUsePersistentCache() is redundant. Use Page::usesEphemeralSession() instead.
        https://bugs.webkit.org/show_bug.cgi?id=155924

        Reviewed by Simon Fraser.

        Remove mediaShouldUsePersistentCache machinery as it is redundant.

        * WebCoreSupport/WebChromeClient.h:
        * WebCoreSupport/WebChromeClient.mm:
        (WebChromeClient::mediaShouldUsePersistentCache): Deleted.

2016-03-30  Ada Chan  <adachan@apple.com>

        Add the new "toggle enhanced fullscreen" context menu item to the video context menu on supporting platforms.
        https://bugs.webkit.org/show_bug.cgi?id=156031

        Reviewed by Eric Carlson.

        * WebView/WebHTMLView.mm:
        (toAction):
        (toTag):
        * WebView/WebUIDelegatePrivate.h:

2016-03-24  Said Abou-Hallawa  <sabouhallawa@apple,com>

        Change NativeImagePtr for CG to be RetainPtr<CGImageRef>
        https://bugs.webkit.org/show_bug.cgi?id=155412

        Reviewed by Darin Adler.

        * Misc/WebCache.mm:
        (+[WebCache addImageToCache:forURL:forFrame:]):
        WebCore::MemoryCache() is taking an rvalue NativeImagePtr. We need to create
        NativeImagePtr from the image raw pointer when calling this function.

2016-03-24  Tim Horton  <timothy_horton@apple.com>

        Fix some new PDFKit-related warnings
        https://bugs.webkit.org/show_bug.cgi?id=155847
        <rdar://problem/25340312>

        Reviewed by Anders Carlsson.

        * WebView/WebPDFView.mm:
        (-[WebPDFView setViewState:]):
        * WebView/WebPreferences.mm:
        (-[WebPreferences PDFDisplayMode]):
        PDFDisplayMode is now a real enum.

2016-03-23  Anders Carlsson  <andersca@apple.com>

        Crash when using KVO from within -[WebView initWithCoder:]
        https://bugs.webkit.org/show_bug.cgi?id=155816
        rdar://problem/17073265

        Reviewed by Dan Bernstein.

        Get rid of the observationInfo getter and setter. It's not clear why they were added (in 2003),
        and the methods on NSObject are good enough for us.

        * WebView/WebView.mm:
        (-[WebView setObservationInfo:]): Deleted.
        (-[WebView observationInfo]): Deleted.
        * WebView/WebViewData.h:

2016-03-22  Beth Dakin  <bdakin@apple.com>

        Advanced spell checking should be guarded behind 
        HAVE(ADVANCED_SPELL_CHECKING)
        https://bugs.webkit.org/show_bug.cgi?id=155738

        Reviewed by Geoff Garen.

        * WebCoreSupport/WebEditorClient.mm:
        (insertionPointFromCurrentSelection):
        (WebEditorClient::checkTextOfParagraph):
        (WebEditorClient::getGuessesForWord):
        (WebEditorClient::requestCandidatesForSelection):
        (WebEditorClient::handleRequestedCandidates):
        (WebEditorClient::requestCheckingOfString):
        * WebKitPrefix.h:
        * WebView/WebHTMLView.mm:
        (-[WebHTMLView insertText:]):

2016-03-20  Dan Bernstein  <mitz@apple.com>

        [Mac] Determine TARGET_MAC_OS_X_VERSION_MAJOR from MACOSX_DEPLOYMENT_TARGET rather than from MAC_OS_X_VERSION_MAJOR
        https://bugs.webkit.org/show_bug.cgi?id=155707
        <rdar://problem/24980691>

        Reviewed by Darin Adler.

        * Configurations/Base.xcconfig: Set TARGET_MAC_OS_X_VERSION_MAJOR based on the last
          component of MACOSX_DEPLOYMENT_TARGET.
        * Configurations/DebugRelease.xcconfig: For engineering builds, preserve the behavior of
          TARGET_MAC_OS_X_VERSION_MAJOR being the hostâ€™s OS version.

2016-03-20  Darin Adler  <darin@apple.com>

        Disable Caches in Safari's Develop menu does not disable caches.
        https://bugs.webkit.org/show_bug.cgi?id=64483

        Reviewed by Antti Koivisto.

        Removed unneeded WebPreferences property; we don't need this for Legacy WebKit.

        * WebView/WebPreferenceKeysPrivate.h: Removed
        WebKitResourceCachingDisabledPreferenceKey.
        * WebView/WebPreferences.mm:
        (-[WebPreferences isResourceCachingDisabled]): Deleted.
        (-[WebPreferences setResourceCachingDisabled:]): Deleted.
        * WebView/WebPreferencesPrivate.h: Removed resourceCachingDisabled property.
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]): Removed code to update resourceCachingDisabled.

2016-03-20  Dan Bernstein  <mitz@apple.com>

        Update build settings

        Rubber-stamped by Andy Estes.

        * Configurations/DebugRelease.xcconfig:
        * Configurations/FeatureDefines.xcconfig:
        * Configurations/Version.xcconfig:

2016-03-18  Darin Adler  <darin@apple.com>

        Disable Caches in Safari's Develop menu does not disable caches.
        https://bugs.webkit.org/show_bug.cgi?id=64483

        Reviewed by Antti Koivisto.

        * WebView/WebPreferenceKeysPrivate.h: Added ResourceCachingDisabled.
        * WebView/WebPreferences.mm:
        (-[WebPreferences isResourceCachingDisabled]): Added.
        (-[WebPreferences setResourceCachingDisabled:]): Added.
        * WebView/WebPreferencesPrivate.h: Added resourceCachingDisabled.
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]): Push resourceCachingDisabled into WebCore.

2016-03-17  Csaba OsztrogonÃ¡c  <ossy@webkit.org>

        [cmake][Mac] Unreviewed speculative buildfix after r198088. Just for fun.

        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):

2016-03-17  Andy Estes  <aestes@apple.com>

        [Mac] Enable Content-Disposition: attachment sandbox
        https://bugs.webkit.org/show_bug.cgi?id=155578
        <rdar://problem/21886326>

        Reviewed by Dan Bernstein.

        Covered by the existing set of attachment sandbox tests, which have always been run on Mac.

        * WebView/WebView.mm:
        (-[WebView _commonInitializationWithFrameName:groupName:]):

2016-03-16  Beth Dakin  <bdakin@apple.com>

        Provide NSSpellChecker spellChecking methods with the current insertion point
        https://bugs.webkit.org/show_bug.cgi?id=155532
        -and corresponding-
        rdar://problem/24066952

        Reviewed by Simon Fraser.

        Extract the insertion point from the VisibleSelection that WebCore has 
        passed. 
        * WebCoreSupport/WebEditorClient.h:
        (WebEditorClient::getGuessesForWord):
        * WebCoreSupport/WebEditorClient.mm:
        (WebEditorClient::checkTextOfParagraph):
        (insertionPointFromCurrentSelection):
        (WebEditorClient::getGuessesForWord):
        (WebEditorClient::requestCheckingOfString):

2016-03-16  Chris Dumez  <cdumez@apple.com>

        Unreviewed, rolling out r198235, r198240, r198241, and
        r198252.

        Causing crashes on ARM

        Reverted changesets:

        "Remove compile time define for SEPARATED_HEAP"
        https://bugs.webkit.org/show_bug.cgi?id=155508
        http://trac.webkit.org/changeset/198235

        "Gardening: build fix after r198235."
        http://trac.webkit.org/changeset/198240

        "Build fix."
        http://trac.webkit.org/changeset/198241

        "Rename performJITMemcpy to something more inline with our
        normal webkit function names"
        https://bugs.webkit.org/show_bug.cgi?id=155525
        http://trac.webkit.org/changeset/198252

2016-03-16  Jiewen Tan  <jiewen_tan@apple.com>

        URL Parsing should signal failure for illegal IDN
        https://bugs.webkit.org/show_bug.cgi?id=154945
        <rdar://problem/8014795>

        Reviewed by Brent Fulgham.

        In this patch, we add new SPIs _webkit_URLWithUserTypedString, _webkit_decodeHostName and
        _webkit_encodeHostName which will return nil while dealing with illegal IDN.

        Old SPIs _web_URLWithUserTypedString, _web_decodeHostName and _web_encodeHostName are marked
        deprecated as they ignore URL parsing failure.

        * History/WebHistoryItem.mm:
        (-[WebHistoryItem initFromDictionaryRepresentation:]):
        * Misc/WebKitErrors.m:
        (+[NSError _webKitErrorWithCode:failingURL:]):
        * Misc/WebNSFileManagerExtras.mm:
        (-[NSFileManager _webkit_setMetadataURL:referrer:atPath:]):
        * Misc/WebNSPasteboardExtras.mm:
        (-[NSPasteboard _web_bestURL]):
        * Misc/WebNSURLExtras.h:
        * Misc/WebNSURLExtras.mm:
        (+[NSURL _web_URLWithUserTypedString:]):
        (+[NSURL _webkit_URLWithUserTypedString:relativeToURL:]):
        (+[NSURL _webkit_URLWithUserTypedString:]):
        (-[NSString _web_decodeHostName]):
        (-[NSString _web_encodeHostName]):
        (-[NSString _webkit_decodeHostName]):
        (-[NSString _webkit_encodeHostName]):
        * Panels/WebAuthenticationPanel.m:
        (-[WebAuthenticationPanel setUpForChallenge:]):
        * WebCoreSupport/WebEditorClient.mm:
        (WebEditorClient::canonicalizeURLString):

2016-03-15  Jer Noble  <jer.noble@apple.com>

        [ios-sim debug] API test WebKit1.AudioSessionCategoryIOS timing out
        https://bugs.webkit.org/show_bug.cgi?id=155275

        Reviewed by Alexey Proskuryakov.

        The videoPlaybackRequiresUserGesture and audioPlaybackRequiresUserGesture should both defalut to
        NO, so that legacy clients of -[UIWebView setMediaPlaybackRequiresUserAction:] continue to work
        as expected.

        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):

2016-03-15  Oliver Hunt  <oliver@apple.com>

        Remove compile time define for SEPARATED_HEAP
        https://bugs.webkit.org/show_bug.cgi?id=155508

        Reviewed by Mark Lam.

        Remove the feature define.

        * Configurations/FeatureDefines.xcconfig:

2016-03-15  Chris Dumez  <cdumez@apple.com>

        Unreviewed, rolling out r198203.

        Favorites view is no longer loading on iOS

        Reverted changeset:

        "URL Parsing should signal failure for illegal IDN"
        https://bugs.webkit.org/show_bug.cgi?id=154945
        http://trac.webkit.org/changeset/198203

2016-03-15  Jiewen Tan  <jiewen_tan@apple.com>

        URL Parsing should signal failure for illegal IDN
        https://bugs.webkit.org/show_bug.cgi?id=154945
        <rdar://problem/8014795>

        Reviewed by Brent Fulgham.

        In this patch, we add new SPIs _webkit_URLWithUserTypedString, _webkit_decodeHostName and
        _webkit_encodeHostName which will return nil while dealing with illegal IDN.

        Old SPIs _web_URLWithUserTypedString, _web_decodeHostName and _web_encodeHostName are marked
        deprecated as they ignore URL parsing failure.

        * History/WebHistoryItem.mm:
        (-[WebHistoryItem initFromDictionaryRepresentation:]):
        * Misc/WebKitErrors.m:
        (+[NSError _webKitErrorWithCode:failingURL:]):
        * Misc/WebNSFileManagerExtras.mm:
        (-[NSFileManager _webkit_setMetadataURL:referrer:atPath:]):
        * Misc/WebNSPasteboardExtras.mm:
        (-[NSPasteboard _web_bestURL]):
        * Misc/WebNSURLExtras.h:
        * Misc/WebNSURLExtras.mm:
        (+[NSURL _web_URLWithUserTypedString:]):
        (+[NSURL _webkit_URLWithUserTypedString:relativeToURL:]):
        (+[NSURL _webkit_URLWithUserTypedString:]):
        (-[NSString _web_decodeHostName]):
        (-[NSString _web_encodeHostName]):
        (-[NSString _webkit_decodeHostName]):
        (-[NSString _webkit_encodeHostName]):
        * Panels/WebAuthenticationPanel.m:
        (-[WebAuthenticationPanel setUpForChallenge:]):
        * WebCoreSupport/WebEditorClient.mm:
        (WebEditorClient::canonicalizeURLString):

2016-03-14  Chris Dumez  <cdumez@apple.com>

        Unreviewed, rolling out r197981.

        Caused a massive PLT regression on Mac.

        Reverted changeset:

        "Font antialiasing (smoothing) changes when elements are
        rendered into compositing layers"
        https://bugs.webkit.org/show_bug.cgi?id=23364
        http://trac.webkit.org/changeset/197981

2016-03-14  Sam Weinig  <sam@webkit.org>

        Add a baseURL parameter to _WKUserStyleSheet
        https://bugs.webkit.org/show_bug.cgi?id=155219

        Reviewed by Tim Horton.

        * WebView/WebView.mm:
        (-[WebView _commonInitializationWithFrameName:groupName:]):
        (-[WebView initSimpleHTMLDocumentWithStyle:frame:preferences:groupName:]):
        (-[WebView setGroupName:]):
        Update to account for the name change from UserContentController -> UserContentProvider.

2016-03-14  Joonghun Park  <jh718.park@samsung.com>

        Purge PassRefPtr from ArrayBuffer, ArchiveResource, Pasteboard, LegacyWebArchive and DataObjectGtk
        https://bugs.webkit.org/show_bug.cgi?id=150497

        Reviewed by Darin Adler.

        * DOM/WebDOMOperations.mm:
        (-[DOMNode webArchive]):
        (-[DOMNode webArchiveByFilteringSubframes:]):
        * WebCoreSupport/WebPlatformStrategies.h:
        * WebCoreSupport/WebPlatformStrategies.mm:
        (WebPlatformStrategies::bufferForType):
        (WebPlatformStrategies::readBufferFromPasteboard):
        * WebView/WebArchive.mm:
        (-[WebArchive initWithData:]):
        * WebView/WebDataSource.mm:
        (-[WebDataSource webArchive]):
        (-[WebDataSource addSubresource:]):
        * WebView/WebResource.mm:
        (-[WebResource encodeWithCoder:]):
        (-[WebResource data]):
        (-[WebResource _stringValue]):
        (-[WebResource _initWithCoreResource:]): Deleted.

2016-03-14  Oliver Hunt  <oliver@apple.com>

        Temporarily disable the separated heap.
        https://bugs.webkit.org/show_bug.cgi?id=155472

        Reviewed by Geoffrey Garen.

        Temporarily disable this.

        * Configurations/FeatureDefines.xcconfig:

2016-03-14  Anders Carlsson  <andersca@apple.com>

        Fix build.

        Ignore nullability warnings, create an empty PDF selection.

        * WebView/WebPDFView.mm:
        (-[WebPDFView centerSelectionInVisibleArea:]):
        (-[WebPDFView searchFor:direction:caseSensitive:wrap:startInSelection:]):
        (+[WebPDFView _PDFSelectionClass]):
        (-[WebPDFView _nextMatchFor:direction:caseSensitive:wrap:fromSelection:startInSelection:]):

2016-03-13  Joseph Pecoraro  <pecoraro@apple.com>

        Remove ENABLE(ES6_TEMPLATE_LITERAL_SYNTAX) guards
        https://bugs.webkit.org/show_bug.cgi?id=155417

        Reviewed by Yusuke Suzuki.

        * Configurations/FeatureDefines.xcconfig:

2016-03-13  Dean Jackson  <dino@apple.com>

        <attachment> should be a runtime-enabled feature
        https://bugs.webkit.org/show_bug.cgi?id=155413
        <rdar://problem/25120753>

        Reviewed by Sam Weinig and Anders Carlsson.

        Add an internal setting on WebPreferences
        to enable the <attachment> element support.

        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):
        (-[WebPreferences attachmentElementEnabled]):
        (-[WebPreferences setAttachmentElementEnabled:]):
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):

2016-03-12  Sam Weinig  <sam@webkit.org>

        WebKit can easily crash below NetworkSession::dataTaskForIdentifier() with NSURLSession enabled
        <rdar://problem/25129946>
        https://bugs.webkit.org/show_bug.cgi?id=155401

        Reviewed by Alex Christensen.

        * WebCoreSupport/WebFrameNetworkingContext.mm:
        (WebFrameNetworkingContext::ensurePrivateBrowsingSession):
        Pass a SessionID to NetworkStorageSession::createPrivateBrowsingSession().

2016-03-12  Myles C. Maxfield  <mmaxfield@apple.com>

        Delete dead SVG Font code
        https://bugs.webkit.org/show_bug.cgi?id=154718

        Reviewed by Antti Koivisto.

        * Configurations/FeatureDefines.xcconfig:

2016-03-11  Yusuke Suzuki  <utatane.tea@gmail.com>

        [ES6] Implement Reflect.set without receiver support
        https://bugs.webkit.org/show_bug.cgi?id=155024

        Reviewed by Geoffrey Garen.

        As the same to NPJSObject, we just propagate the returned value of NetscapePluginInstanceProxy::setProperty.

        * Plugins/Hosted/ProxyInstance.h:
        * Plugins/Hosted/ProxyInstance.mm:
        (WebKit::ProxyField::setValueToInstance):
        (WebKit::ProxyInstance::setFieldValue):

2016-03-10  Jeremy Jones  <jeremyj@apple.com>

        Set AVURLAssetUsesNoPersistentCacheKey on AVAsset to match caching policy.
        https://bugs.webkit.org/show_bug.cgi?id=155117
        rdar://problem/6802240

        Reviewed by Simon Fraser.

        Implement mediaShouldUsePersistentCache to disable media caching when NSURLCache is disabled.

        * WebCoreSupport/WebChromeClient.h:
        * WebCoreSupport/WebChromeClient.mm:
        (WebChromeClient::mediaShouldUsePersistentCache): Added.

2016-03-10  Simon Fraser  <simon.fraser@apple.com>

        Font antialiasing (smoothing) changes when elements are rendered into compositing layers
        https://bugs.webkit.org/show_bug.cgi?id=23364

        Reviewed by Tim Horton.

        Allow internal clients to turn off smoothed layer text, so that WebKitTestRunner
        can disable it.

        * WebView/WebView.mm:
        (+[WebView _setSmoothedLayerTextEnabled:]):
        (+[WebView _smoothedLayerTextEnabled]):
        * WebView/WebViewPrivate.h:

2016-03-10  Jer Noble  <jer.noble@apple.com>

        Add WebCore, WebKit, & WebKit2 preference/setting to enable Main Content heuristic.
        https://bugs.webkit.org/show_bug.cgi?id=155326
        <rdar://problem/25095408>

        Reviewed by Beth Dakin.

        Add SPI to get and set the new preference.

        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (-[WebPreferences overrideUserGestureRequirementForMainContent]):
        (-[WebPreferences setOverrideUserGestureRequirementForMainContent:]):
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):

2016-03-07  Jer Noble  <jer.noble@apple.com>

        Add separate WK and WK2 preferences for requiring user gestures for video media, distinct from user gestures for media generally
        https://bugs.webkit.org/show_bug.cgi?id=155141

        Reviewed by Beth Dakin.

        Deprecate WebPreferences.mediaPlaybackRequiresUserGesture property in favor of .videoPlaybackRequiresUserGesture.

        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):
        (-[WebPreferences mediaPlaybackRequiresUserGesture]):
        (-[WebPreferences setMediaPlaybackRequiresUserGesture:]):
        (-[WebPreferences videoPlaybackRequiresUserGesture]):
        (-[WebPreferences setVideoPlaybackRequiresUserGesture:]):
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):

2016-03-10  Alexey Proskuryakov  <ap@apple.com>

        Build fix for deprecated constant names.

        * Carbon/CarbonWindowAdapter.mm:
        (-[CarbonWindowAdapter initWithCarbonWindowRef:takingOwnership:disableOrdering:carbon:]):
        (-[CarbonWindowAdapter sendSuperEvent:]):

2016-03-10  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r197943.
        https://bugs.webkit.org/show_bug.cgi?id=155317

        This change broke Windows, WinCairo, GTK and EFL builds
        (Requested by ryanhaddad on #webkit).

        Reverted changeset:

        "Add a baseURL parameter to _WKUserStyleSheet"
        https://bugs.webkit.org/show_bug.cgi?id=155219
        http://trac.webkit.org/changeset/197943

2016-03-08  Sam Weinig  <sam@webkit.org>

        Add a baseURL parameter to _WKUserStyleSheet
        https://bugs.webkit.org/show_bug.cgi?id=155219

        Reviewed by Tim Horton.

        * WebView/WebView.mm:
        (-[WebView _commonInitializationWithFrameName:groupName:]):
        (-[WebView initSimpleHTMLDocumentWithStyle:frame:preferences:groupName:]):
        (-[WebView setGroupName:]):
        Update to account for the name change from UserContentController -> UserContentProvider.

2016-02-22  Jer Noble  <jer.noble@apple.com>

        Enable AVFoundationNSURLSessionEnabled by default
        https://bugs.webkit.org/show_bug.cgi?id=154469

        Reviewed by Sam Weinig.

        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):

2016-03-09  Ryosuke Niwa  <rniwa@webkit.org>

        Add runtime flags for shadow DOM and custom elements
        https://bugs.webkit.org/show_bug.cgi?id=155213

        Reviewed by Dean Jackson.

        Set the runtime flag based on preferences. Enable shadow DOM and disable custom elements by default.

        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):
        (-[WebPreferences shadowDOMEnabled]):
        (-[WebPreferences setShadowDOMEnabled:]):
        (-[WebPreferences customElementsEnabled]):
        (-[WebPreferences setCustomElementsEnabled:]):
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):

2016-03-09  David Kilzer  <ddkilzer@apple.com>

        REGRESSION (r197149): Missing availability checks when soft-linking DataDetectors.framework
        <http://webkit.org/b/155258>

        Reviewed by Andy Estes.

        * WebView/WebImmediateActionController.mm:
        (-[WebImmediateActionController _clearImmediateActionState]):
        (-[WebImmediateActionController immediateActionRecognizerWillBeginAnimation:]):
        (-[WebImmediateActionController _animationControllerForDataDetectedText]):
        (-[WebImmediateActionController _animationControllerForDataDetectedLink]):
        - Add check that returns early if DataDetectors.framework is not
          available.

2016-03-08  Oliver Hunt  <oliver@apple.com>

        Start moving to separated writable and executable mappings in the JIT
        https://bugs.webkit.org/show_bug.cgi?id=155178

        Reviewed by Fil Pizlo.

        Update feature defines.

        * Configurations/FeatureDefines.xcconfig:

2016-03-08  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r197793 and r197799.
        https://bugs.webkit.org/show_bug.cgi?id=155195

        something weird happened while landing this and everything
        broke (Requested by olliej on #webkit).

        Reverted changesets:

        "Start moving to separated writable and executable mappings in
        the JIT"
        https://bugs.webkit.org/show_bug.cgi?id=155178
        http://trac.webkit.org/changeset/197793

        "arm64 build fix after r197793."
        http://trac.webkit.org/changeset/197799

2016-03-08  Oliver Hunt  <oliver@apple.com>

        Start moving to separated writable and executable mappings in the JIT
        https://bugs.webkit.org/show_bug.cgi?id=155178

        Reviewed by Filip Pizlo.

        Update feature defines.

        * Configurations/FeatureDefines.xcconfig:

2016-03-08  Anders Carlsson  <andersca@apple.com>

        Ignore deprecation warnings.

        * Misc/WebNSEventExtras.m:
        (-[NSEvent _web_isKeyEvent:]):
        (-[NSEvent _web_isOptionTabKeyEvent]):
        * Misc/WebNSViewExtras.m:
        (-[NSView _web_dragShouldBeginFromMouseDown:withExpiration:xHysteresis:yHysteresis:]):
        * Plugins/Hosted/NetscapePluginHostProxy.mm:
        (WebKit::NetscapePluginHostProxy::beginModal):
        * Plugins/Hosted/NetscapePluginInstanceProxy.mm:
        (WebKit::NetscapePluginInstanceProxy::syntheticKeyDownWithCommandModifier):
        * Plugins/Hosted/WebHostedNetscapePluginView.mm:
        (-[WebHostedNetscapePluginView drawRect:]):
        * Plugins/WebNetscapePluginEventHandlerCocoa.mm:
        (WebNetscapePluginEventHandlerCocoa::syntheticKeyDownWithCommandModifier):
        * WebCoreSupport/PopupMenuMac.mm:
        (PopupMenuMac::populate):
        (PopupMenuMac::show):
        * WebCoreSupport/WebContextMenuClient.mm:
        (WebContextMenuClient::showContextMenu):
        * WebCoreSupport/WebFrameLoaderClient.mm:
        (WebFrameLoaderClient::actionDictionary):
        * WebCoreSupport/WebInspectorClient.mm:
        (WebInspectorFrontendClient::canAttach):
        (-[WebInspectorWindowController window]):
        * WebInspector/WebNodeHighlight.mm:
        (-[WebNodeHighlight initWithTargetView:inspectorController:]):
        * WebView/WebFrameView.mm:
        (-[WebFrameView keyDown:keyDown:]):
        * WebView/WebFullScreenController.mm:
        (-[WebFullScreenController init]):
        (createBackgroundFullscreenWindow):
        * WebView/WebHTMLView.mm:
        (-[WebHTMLView _postFakeMouseMovedEventForFlagsChangedEvent:]):
        (-[WebHTMLView _setMouseDownEvent:_setMouseDownEvent:]):
        (isQuickLookEvent):
        (-[WebHTMLView hitTest:]):
        (-[WebHTMLView _sendToolTipMouseExited]):
        (-[WebHTMLView _sendToolTipMouseEntered]):
        (mouseEventIsPartOfClickOrDrag):
        (-[WebHTMLView _updateMouseoverWithEvent:]):
        (-[WebHTMLView acceptsFirstResponder]):
        (-[WebHTMLView viewDidMoveToWindow]):
        (currentKeyboardEvent):
        (-[WebHTMLView _handleStyleKeyEquivalent:]):
        (-[WebHTMLView _interpretKeyEvent:savingCommands:]):
        * WebView/WebPDFView.mm:
        (-[WebPDFView hitTest:]):
        (-[WebPDFView PDFViewWillClickOnLink:withURL:]):
        (-[WebPDFView _fakeKeyEventWithFunctionKey:]):
        * WebView/WebTextCompletionController.mm:
        (-[WebTextCompletionController _buildUI]):
        (-[WebTextCompletionController _placePopupWindow:]):
        * WebView/WebView.mm:
        (-[WebView applicationFlags:]):

2016-03-07  Brent Fulgham  <bfulgham@apple.com>

        Reduce startup and shutdown cost of resource load statistics
        https://bugs.webkit.org/show_bug.cgi?id=155120
        <rdar://problem/25010167>

        Reviewed by Andy Estes.

        Remove the Resource Load Statistics stuff from WK1, now that it is up and
        running in WK2.

        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]): Remove call to read resource load
        statistics from disk.
        (+[WebView _applicationWillTerminate]): Remove call to write resource load
        statistics to disk.

2016-03-06  Andreas Kling  <akling@apple.com>

        Reduce page cache capacity from 3 to 2.
        <https://webkit.org/b/155087>

        Reviewed by Antti Koivisto.

        Trim WebKit1 page cache capacities consistently with WebKit2.

        * WebView/WebView.mm:
        (+[WebView _setCacheModel:]):

2016-03-05  Chris Dumez  <cdumez@apple.com>

        Consolidate RuntimeApplicationChecks and RuntimeApplicationChecksIOS
        https://bugs.webkit.org/show_bug.cgi?id=155035

        Reviewed by Darin Adler.

        Update runtime application checks.

        * Plugins/WebPluginController.mm:
        (initializeAudioSession):
        * WebCoreSupport/WebFrameLoaderClient.mm:
        * WebView/WebFrame.mm:
        (needsMicrosoftMessengerDOMDocumentWorkaround):
        * WebView/WebImmediateActionController.mm:
        (-[WebImmediateActionController _updateImmediateActionItem]):
        * WebView/WebView.mm:
        (WebKitInitializeApplicationCachePathIfNecessary):
        (shouldEnableLoadDeferring):
        (shouldRestrictWindowFocus):
        (needsOutlookQuirksScript):
        (shouldTransformsAffectOverflow):
        (shouldDispatchJavaScriptWindowOnErrorEvents):
        (shouldUseLegacyBackgroundSizeShorthandBehavior):
        (-[WebView _commonInitializationWithFrameName:groupName:]):
        (+[WebView enableWebThread]):
        (+[WebView registerForMemoryNotifications]):
        (-[WebView _needsKeyboardEventDisambiguationQuirks]):
        (needsSelfRetainWhileLoadingQuirk):
        (-[WebView _needsPreHTML5ParserQuirks]):

2016-03-05  Yusuke Suzuki  <utatane.tea@gmail.com>

        [ES6] Support Reflect.construct
        https://bugs.webkit.org/show_bug.cgi?id=147330

        Reviewed by Saam Barati.

        * Plugins/Hosted/NetscapePluginInstanceProxy.mm:
        (WebKit::NetscapePluginInstanceProxy::invoke):
        (WebKit::NetscapePluginInstanceProxy::invokeDefault):
        (WebKit::NetscapePluginInstanceProxy::construct):

2016-03-04  Brent Fulgham  <bfulgham@apple.com>

        Unreviewed test fix for null global WebResourceLoadStatisticsStore.

        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):
        (+[WebView _applicationWillTerminate]):

2016-03-04  Brent Fulgham  <bfulgham@apple.com>

        [WK2] Gather resource load statistics
        https://bugs.webkit.org/show_bug.cgi?id=154278
        <rdar://problem/24702892>

        Reviewed by Andy Estes.

        Switch to maintaining a global WebCore::ResourceLoadStatisticsStore in the WebKit process,
        and hand it off to the WebCore layer to use during data gathering. The ResourceLoadStatisticsStore
        is now responsible for reading/writing to disk, and tracking the collection of load data.

        * WebView/WebView.mm:
        (WebKitInitializeApplicationStatisticsStoragePathIfNecessary): Initialize singleton
        ResourceLoadStatisticsStore object for tracking state.
        (-[WebView _preferencesChanged:]): Revise for new singleton.
        (+[WebView _applicationWillTerminate]): Ditto.

2016-02-29  Ada Chan  <adachan@apple.com>

        Adopt the new version of AVOutputDeviceMenuController's showMenuForRect method.
        https://bugs.webkit.org/show_bug.cgi?id=154823

        Reviewed by Tim Horton.

        * WebCoreSupport/WebChromeClient.h:
        * WebCoreSupport/WebChromeClient.mm:
        (WebChromeClient::showPlaybackTargetPicker):
        * WebView/WebMediaPlaybackTargetPicker.h:
        * WebView/WebMediaPlaybackTargetPicker.mm:
        (WebMediaPlaybackTargetPicker::showPlaybackTargetPicker):
        (WebMediaPlaybackTargetPicker::customPlaybackActionSelected):
        * WebView/WebView.mm:
        (-[WebView _showPlaybackTargetPicker:location:hasVideo:]):

2016-03-01  Tim Horton  <timothy_horton@apple.com>

        Expose MediaElement and VideoElement to the Objective-C DOM bindings
        https://bugs.webkit.org/show_bug.cgi?id=154830

        Reviewed by Sam Weinig.

        * MigrateHeaders.make:

2016-02-29  Simon Fraser  <simon.fraser@apple.com>

        Remove the experimental feature of antialiased font dilation
        https://bugs.webkit.org/show_bug.cgi?id=154843

        Reviewed by Zalan Bujtas.

        Remove the "antialiased font dilation" code path, and related prefs.

        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]): Deleted.
        (-[WebPreferences setAntialiasedFontDilationEnabled:]): Deleted.
        (-[WebPreferences antialiasedFontDilationEnabled]): Deleted.
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]): Deleted.

2016-02-26  Dan Bernstein  <mitz@apple.com>

        Build fix for when WK_OVERRIDE_FRAMEWORKS_DIR contains spaces.

        * Configurations/WebKitLegacy.xcconfig: Added quotes.

2016-02-25  Ada Chan  <adachan@apple.com>

        Update the definition of ENABLE_VIDEO_PRESENTATION_MODE for Mac platform
        https://bugs.webkit.org/show_bug.cgi?id=154702

        Reviewed by Dan Bernstein.

        * Configurations/FeatureDefines.xcconfig:

2016-02-25  Jiewen Tan  <jiewen_tan@apple.com>

        Restrict information passed with navigation action which is triggered by untrusted event
        https://bugs.webkit.org/show_bug.cgi?id=154571
        <rdar://problem/15967937>

        Reviewed by Andy Estes.

        * WebCoreSupport/WebFrameLoaderClient.mm:
        (WebFrameLoaderClient::actionDictionary):

2016-02-25  Eric Carlson  <eric.carlson@apple.com>

        [MediaStream] MediaDeviceInfo deviceId and groupId must be unique to the page's origin
        https://bugs.webkit.org/show_bug.cgi?id=153163
        <rdar://problem/24334526>

        Reviewed by Tim Horton.

        * WebCoreSupport/WebUserMediaClient.mm:
        (WebUserMediaClient::requestUserMediaAccess):
        (WebUserMediaClient::checkUserMediaPermission):
        (-[WebUserMediaPolicyCheckerListener allow]):
        (-[WebUserMediaPolicyCheckerListener deny]):

2016-02-24  Nikos Andronikos  <nikos.andronikos-webkit@cisra.canon.com.au>

        [web-animations] Add AnimationTimeline, DocumentTimeline and add extensions to Document interface
        https://bugs.webkit.org/show_bug.cgi?id=151688

        Reviewed by Dean Jackson.

        Enables the WEB_ANIMATIONS compiler switch.

        * Configurations/FeatureDefines.xcconfig:

2016-02-23  Dan Bernstein  <mitz@apple.com>

        [Xcode] Linker errors display mangled names, but no longer should
        https://bugs.webkit.org/show_bug.cgi?id=154632

        Reviewed by Sam Weinig.

        * Configurations/Base.xcconfig: Stop setting LINKER_DISPLAYS_MANGLED_NAMES to YES.

2016-02-23  Gavin Barraclough  <barraclough@apple.com>

        Remove HIDDEN_PAGE_DOM_TIMER_THROTTLING feature define
        https://bugs.webkit.org/show_bug.cgi?id=112323

        Reviewed by Chris Dumez.

        This feature is controlled by a runtime switch, and defaults off.

        * Configurations/FeatureDefines.xcconfig:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):

2016-02-22  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r196935.
        https://bugs.webkit.org/show_bug.cgi?id=154557

        This change causes timeouts and crashes in LayoutTests
        (Requested by ryanhaddad on #webkit).

        Reverted changeset:

        "Enable AVFoundationNSURLSessionEnabled by default"
        https://bugs.webkit.org/show_bug.cgi?id=154469
        http://trac.webkit.org/changeset/196935

2016-02-22  Keith Rollin  <krollin@apple.com>

        Add mechanism to disable memory pressure handling
        https://bugs.webkit.org/show_bug.cgi?id=154254
        <rdar://problem/24662616>

        Reviewed by Chris Dumez.

        Add a mechanism to disable WebKit's response to memory pressure
        triggers. This was asked for by another group for testing purposes.

        In order to disable WebKit's memory pressure handling, execute the
        following from the command line:

            defaults write com.apple.Safari WebKitSuppressMemoryPressureHandler -bool true

        To revert to standard behavior, delete the key or set it to False.

        This flag is used when a new sub-process is being spawned. The value
        is read and stored in an initialization parameter block, which is then
        sent to the new sub-process.

        In actuality, only the UI, WebContent, and Network processes heed the
        flag. The Plugin process isn't instrumented to heed this flag for
        three reasons. First, the Plugin process installs its memory pressure
        handler in initializeProcess, not initializePluginProcess. This is
        contrary to when the other processes install their handlers, which is
        in initialize<PluginType>Process, not initializeProcess. So in order
        to accomodate the Plugin process, we'd need to modify
        ChildProcessInitializationParameters. Doing this is awkward at best,
        but also seems to be opposed to what's supposed to be done in
        initializeProcess and conveyed in
        ChildProcessInitializationParameters. And even if we did add a boolean
        to this structure and added support for conveying it through the XPC
        port, it would end up being a Plugin process-only boolean in a general
        parameter block, which seems asymmetric with the other processes.
        Second, there's no convenient Cocoa function called in the flow that
        spawns the Plugin process, meaning that there's no convenient place to
        call NSUserDefaults to get the flag's value. And third, the Plugin
        process doesn't elegantly respond to the memory pressure trigger
        anyway. It might terminate itself, but that's it. As for the Database
        process, it doesn't seem to support responding to memory pressure at
        all, so we don't send it a flag telling it to ignore it.

        Internally, the memory pressure handler is suppressed by not calling
        MemoryPressureHandler::install() if the flag is set. In the case of
        the Network process, the flag is saved so that it can be checked later
        in other places that manually kick off the memory pressure handling
        procedure.

        * WebView/WebView.mm:
        (-[WebView _commonInitializationWithFrameName:groupName:]):
        (WebInstallMemoryPressureHandler):

2016-02-22  Jer Noble  <jer.noble@apple.com>

        Enable AVFoundationNSURLSessionEnabled by default
        https://bugs.webkit.org/show_bug.cgi?id=154469

        Reviewed by Sam Weinig.

        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):

2016-02-15  Brent Fulgham  <bfulgham@apple.com>

        [Mac] Gather some rudimentary statistics during resource load 
        https://bugs.webkit.org/show_bug.cgi?id=153575
        <rdar://problem/24075254>

        Reviewed by Brady Eidson.

        * Misc/WebKitNSStringExtras.h:
        * Misc/WebKitNSStringExtras.mm:
        (+[NSString _webkit_localStorageDirectoryWithBundleIdentifier:]): Added.
        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):
        (-[WebPreferences resourceLoadStatisticsEnabled]): Added.
        (-[WebPreferences setResourceLoadStatisticsEnabled:]): Added.
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (WebKitInitializeApplicationCachePathIfNecessary):
        (WebKitInitializeApplicationStatisticsStoragePathIfNecessary): Added.
        (-[WebView _commonInitializationWithFrameName:groupName:]): Add call to new
        initialization method.
        (-[WebView _preferencesChanged:]): Track changes in the user's desire to
        monitor resource load statistics.
        (+[WebView _applicationWillTerminate]): Write statistics to disk (if preferences
        say to do so.)

2016-02-13  Mark Lam  <mark.lam@apple.com>

        Add thread violation checks to WebView public APIs.
        https://bugs.webkit.org/show_bug.cgi?id=154183

        Reviewed by Timothy Hatcher.

        Re-landing r196527 with a newly added WebCoreThreadViolationCheckRoundThree().
        Previously was using WebCoreThreadViolationCheckRoundTwo().

        * Misc/WebKitVersionChecks.h:
        * WebView/WebFrameView.mm:
        (-[WebFrameView initWithFrame:]):
        * WebView/WebView.mm:
        (-[WebView setCustomTextEncodingName:]):
        (-[WebView stringByEvaluatingJavaScriptFromString:]):
        (-[WebView windowScriptObject]):
        (-[WebView setGroupName:]):
        (-[WebView setMainFrameURL:]):
        (-[WebView mainFrameTitle]):
        (-[WebView mainFrameIcon]):
        (-[WebView setDrawsBackground:]):
        (-[WebView setShouldUpdateWhileOffscreen:]):

2016-02-12  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r196527.
        https://bugs.webkit.org/show_bug.cgi?id=154204

        "Need to redo as WebCoreThreadViolationCheckRoundThree"
        (Requested by mlam on #webkit).

        Reverted changeset:

        "Add thread violation checks to WebView public APIs."
        https://bugs.webkit.org/show_bug.cgi?id=154183
        http://trac.webkit.org/changeset/196527

2016-02-12  Mark Lam  <mark.lam@apple.com>

        Add thread violation checks to WebView public APIs.
        https://bugs.webkit.org/show_bug.cgi?id=154183

        Reviewed by Geoffrey Garen.

        This will help clients of the API detect the violations sooner rather than
        having to debug mysterious crashes / failures later.

        To that end, I've added thread violation checks to the following functions
        because ...

        * WebView/WebView.mm:
        (-[WebView setCustomTextEncodingName:]):
        - Uses the FrameLoader (which is for the main thread only).

        (-[WebView stringByEvaluatingJavaScriptFromString:]):
        - Invokes JavaScript (which is for the main thread only).

        (-[WebView windowScriptObject]):
        - Invokes ScriptController::windowScriptObject() which requires the JSLock.

        (-[WebView setGroupName:]):
        - Manipulates the PageGroup and Page (which is for the main thread only).

        (-[WebView setMainFrameURL:]):
        - Uses the FrameLoader (which is for the main thread only).

        (-[WebView mainFrameTitle]):
        - Uses the FrameLoader::documentLoader() (via [WebFrame _dataSource]) which
          is RefPtr, and therefore not safe for other threads to access.

        (-[WebView mainFrameIcon]):
        - Uses the FrameLoader::documentLoader() (via [WebFrame _dataSource]) which
          is RefPtr, and therefore not safe for other threads to access.
        - Uses [WebIconDatabase sharedIconDatabase] which does a singleton
          instantiation but is not protected by a lock.

        (-[WebView setDrawsBackground:]):
        - Potentially manipulates a RenderView (via FrameView::setBaseBackgroundColor,
          via [WebFrame _updateBackgroundAndUpdatesWhileOffscreen]), and RenderView
          is for main thread only use.

        (-[WebView setShouldUpdateWhileOffscreen:]):
        - Uses [WebFrame _updateBackgroundAndUpdatesWhileOffscreen].  Hence, for the
          main thread only.

2016-02-12  Sukolsak Sakshuwong  <sukolsak@gmail.com>

        Update ICU header files to version 52
        https://bugs.webkit.org/show_bug.cgi?id=154160

        Reviewed by Alex Christensen.

        Update ICU header files to version 52 to allow the use of newer APIs.

        * icu/unicode/localpointer.h:
        * icu/unicode/platform.h:
        * icu/unicode/ptypes.h:
        * icu/unicode/putil.h:
        * icu/unicode/uchar.h:
        * icu/unicode/uconfig.h:
        * icu/unicode/uidna.h:
        * icu/unicode/uiter.h:
        * icu/unicode/umachine.h:
        * icu/unicode/unorm2.h:
        * icu/unicode/urename.h:
        * icu/unicode/uscript.h:
        * icu/unicode/ustring.h:
        * icu/unicode/utf.h:
        * icu/unicode/utf16.h:
        * icu/unicode/utf8.h:
        * icu/unicode/utf_old.h:
        * icu/unicode/utypes.h:
        * icu/unicode/uvernum.h:
        * icu/unicode/uversion.h:

2016-02-12  Beth Dakin  <bdakin@apple.com>

        NSRangeIsRelativeTo should not have NS prefix
        https://bugs.webkit.org/show_bug.cgi?id=154174

        Reviewed by Tim Horton.

        NSRangeIsRelativeTo -> WebRangeIsRelativeTo
        * WebView/WebFrame.mm:
        (-[WebFrame _convertToDOMRange:]):
        (-[WebFrame _convertToDOMRange:rangeIsRelativeTo:]):
        * WebView/WebFrameInternal.h:
        * WebView/WebHTMLView.mm:
        (-[WebHTMLView insertText:]):

2016-02-11  Beth Dakin  <bdakin@apple.com>

        EditingRangeIsRelativeTo::Document and NSRangeIsRelativeTo::Document should 
        be called EditableRoot instead
        https://bugs.webkit.org/show_bug.cgi?id=154138

        Reviewed by Alexey Proskuryakov.

        EditableRoot is much more accurate than Document.
        * WebView/WebFrame.mm:
        (-[WebFrame _convertToDOMRange:]):
        (-[WebFrame _convertToDOMRange:rangeIsRelativeTo:]):
        * WebView/WebFrameInternal.h:
        * WebView/WebHTMLView.mm:
        (-[WebHTMLView insertText:]):

2016-02-11  Beth Dakin  <bdakin@apple.com>

        Soft spaces are often tracked in the wrong spot
        https://bugs.webkit.org/show_bug.cgi?id=154127
        -and corresponding-
        rdar://problem/24493140

        Reviewed by Sam Weinig.

        Soft spaces are in the wrong space now for two reasons. First of all, the 
        NSRange we get from the accepted candidate is relative to the paragraph 
        start, so without this patch, soft spaces are only ever right for the first 
        paragraph. Secondly, if focus changes for any reason other than text 
        insertion, soft spaces are also wrong because they need to be re-set.

        New version of _convertToDOMRange takes a NSRangeIsRelativeTo so that it can 
        handle ranges relative to both the document and the paragraph. 
        * WebView/WebFrame.mm:
        (-[WebFrame _convertToDOMRange:rangeIsRelativeTo:]):
        (-[WebFrame _convertNSRangeToDOMRange:]):

        New enum NSRangeIsRelativeTo.
        * WebView/WebFrameInternal.h:

        Re-set the softSpaceRange on selection changes so long as the WebCore::Editor 
        is not currently handling an accepted candidate.
        * WebView/WebHTMLView.mm:
        (-[WebHTMLView _selectionChanged]):

        If needToRemoveSoftSpace is true, then the replacementRange is 
        relative to the paragraph.
        (-[WebHTMLView insertText:]):

2016-02-10  Mark Lam  <mark.lam@apple.com>

        WebFrame _stringByEvaluatingJavaScriptFromString:forceUserGesture: should assert that it is being called from the "main" thread.
        https://bugs.webkit.org/show_bug.cgi?id=154059

        Reviewed by Geoffrey Garen.

        This makes it so that misbehaving clients which call it (indirectly) from another
        thread (not the main thread) will fail faster.  Otherwise, we get potential
        memory corruption that results in strange crashes elsewhere later.

        * WebView/WebFrame.mm:
        (-[WebFrame _stringByEvaluatingJavaScriptFromString:forceUserGesture:]):

2016-02-04  Jer Noble  <jer.noble@apple.com>

        [Mac] Adopt NSURLSession properties in AVAssetResourceLoader
        https://bugs.webkit.org/show_bug.cgi?id=153873

        Reviewed by Eric Carlson.

        Add a WebKit preference to control the WebCore isAVFoundationNSURLSessionEnabled()
        setting.

        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):
        (-[WebPreferences setAVFoundationNSURLSessionEnabled:]):
        (-[WebPreferences isAVFoundationNSURLSessionEnabled]):
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):

2016-02-09  Eric Carlson  <eric.carlson@apple.com>

        checkValidity() sometimes asserts in WebUserMediaClient::pageDestroyed
        https://bugs.webkit.org/show_bug.cgi?id=154029
        <rdar://problem/24065022>

        Reviewed by Alex Christensen.

        * WebCoreSupport/WebUserMediaClient.mm:
        (WebUserMediaClient::pageDestroyed): Copy map keys to a vector and clear the map before
          enumerating the vector and canceling the requests. ASSERT that the map is not modified
          during cleanup. Clean up the permission check map.
        (WebUserMediaClient::requestUserMediaAccess): Add the request to the map before calling the
          UI delegate in case it works synchronously (as it does in DRT).
        (WebUserMediaClient::checkUserMediaPermission): Ditto.
        (WebUserMediaClient::cancelUserMediaPermissionCheck): White-space cleanup.
        (-[WebUserMediaPolicyListener allow]): Ditto.

2016-02-08  Anders Carlsson  <andersca@apple.com>

        Crash when trying to chain to the old -[NSView setNeedsDisplayInRect:]
        https://bugs.webkit.org/show_bug.cgi?id=154001
        rdar://problem/24519975

        Reviewed by Dan Bernstein.

        If our replaced -[NSView setNeedsDisplayInRect:] is called before the old IMP has been initialized,
        we can end up trying to call a null pointer. 
        
        Fix this by using method_exchangeImplementations instead of method_setImplementation, since the former is done
        atomically.

        * WebView/WebHTMLView.mm:
        (-[NSView _web_setNeedsDisplayInRect:]):
        (+[WebHTMLViewPrivate initialize]):
        (setNeedsDisplayInRect): Deleted.

2016-02-07  Dan Bernstein  <mitz@apple.com>

        [Cocoa] Replace __has_include guards around inclusion of Apple-internal-SDK headers with USE(APPLE_INTERNAL_SDK)
        https://bugs.webkit.org/show_bug.cgi?id=153963

        Reviewed by Sam Weinig.

        * WebView/WebPDFView.mm:

2016-02-06  Darin Adler  <darin@apple.com>

        Finish auditing call sites of upper() and lower(), eliminate many, and rename the functions
        https://bugs.webkit.org/show_bug.cgi?id=153905

        Reviewed by Sam Weinig.

        * Plugins/WebBasePluginPackage.mm:
        (-[WebBasePluginPackage getPluginInfoFromPLists]): Use modern for loops.
        (-[WebBasePluginPackage supportsExtension:]): Use convertToASCIILowercase for extension assert.
        Also use modern for loop.
        (-[WebBasePluginPackage supportsMIMEType:]): Ditto.
        (-[WebBasePluginPackage MIMETypeForExtension:]): Ditto.

2016-02-03  Jessie Berlin  <jberlin@webkit.org>

        Build fix.

        [NSEvent context] has always returned nil. Replace uses with nullptr.

        * WebView/WebHTMLView.mm:
        (-[WebHTMLView _postFakeMouseMovedEventForFlagsChangedEvent:]):
        (-[WebHTMLView _updateMouseoverWithFakeEvent]):
        (-[WebHTMLView _updateMouseoverWithEvent:]):
        (-[WebHTMLView _autoscroll]):
        (-[WebHTMLView draggedImage:endedAt:operation:]):

2016-02-01  Dave Hyatt  <hyatt@apple.com>

        Add a line grid pagination SPI to WebKit.
        https://bugs.webkit.org/show_bug.cgi?id=153757
        <rdar://problem/23041598>

        Reviewed by Anders Carlsson.

        * WebView/WebView.mm:
        (-[WebView _setPaginationLineGridEnabled:]):
        (-[WebView _paginationLineGridEnabled]):
        * WebView/WebViewPrivate.h:

2016-02-01  Joseph Pecoraro  <pecoraro@apple.com>

        Web Inspector: High Level Memory Overview Instrument
        https://bugs.webkit.org/show_bug.cgi?id=153516
        <rdar://problem/24356378>

        Reviewed by Brian Burg.

        * Configurations/FeatureDefines.xcconfig:

2016-01-31  Darin Adler  <darin@apple.com>

        Cut down on calls to String::lower; mostly replace with convertToASCIILowercase
        https://bugs.webkit.org/show_bug.cgi?id=153732

        Reviewed by Dean Jackson.

        * WebView/WebHTMLRepresentation.mm:
        (newArrayWithStrings): Updated to use HashSet<String, ASCIICaseInsensitiveHash>
        and also to use a modern for loop.

2016-01-31  Dan Bernstein  <mitz@apple.com>

        [Cocoa] Remove __has_include guards around use of WebKitAdditions
        https://bugs.webkit.org/show_bug.cgi?id=153728

        Reviewed by Andy Estes.

        Guard WebKitAdditions includes with #if USE(APPLE_INTERNAL_SDK) rather than with __has_include.

        * WebKitAdditions.mm:
        * WebView/WebView.mm:
        (-[WebView _commonInitializationWithFrameName:groupName:]):
        (-[WebView initSimpleHTMLDocumentWithStyle:frame:preferences:groupName:]):

2016-01-29  Ada Chan  <adachan@apple.com>

        Enable VIDEO_PRESENTATION_MODE only in Debug and Release builds on Mac
        https://bugs.webkit.org/show_bug.cgi?id=153665

        Reviewed by Dan Bernstein.

        * Configurations/FeatureDefines.xcconfig:

2016-01-28  Darin Adler  <darin@apple.com>

        Remove equalIgnoringCase since all callers really wanted equalIgnoringASCIICase
        https://bugs.webkit.org/show_bug.cgi?id=153411

        Reviewed by Ryosuke Niwa.

        * WebCoreSupport/WebFrameLoaderClient.mm:
        (parameterValue): Use equalIgnoringASCIICase. No behavior change because the
        only name we ever search for with this is "pluginspage".

2016-01-27  Enrica Casucci  <enrica@apple.com>

        Cache results of data detection in the UI process when load completes.
        https://bugs.webkit.org/show_bug.cgi?id=153560

        Reviewed by Tim Horton.

        Adding empty implementation for WK1.

        * WebCoreSupport/WebFrameLoaderClient.h:
        * WebCoreSupport/WebFrameLoaderClient.mm:
        (WebFrameLoaderClient::dispatchDidFinishDataDetection):

2016-01-27  Anders Carlsson  <andersca@apple.com>

        Add WebKitAdditions extension points to WebCore, WebKit and WebKitLegacy
        https://bugs.webkit.org/show_bug.cgi?id=153550

        Reviewed by Sam Weinig.

        * Configurations/WebKitLegacy.xcconfig:
        Add WKA header search paths.

        * WebKitAdditions.mm: Added.
        Add addition files.

        * WebView/WebView.mm:
        (-[WebView _commonInitializationWithFrameName:groupName:]):
        (-[WebView initSimpleHTMLDocumentWithStyle:frame:preferences:groupName:]):
        Add extension points.

2016-01-27  Chris Dumez  <cdumez@apple.com>

        window.atob() should ignore spaces in input
        https://bugs.webkit.org/show_bug.cgi?id=153522
        <rdar://problem/24357822>

        Reviewed by Benjamin Poulain.

        * WebCoreSupport/WebInspectorClient.mm:
        (WebInspectorFrontendClient::save):

2016-01-27  Alexey Proskuryakov  <ap@apple.com>

        Remove ENABLE_CURRENTSRC
        https://bugs.webkit.org/show_bug.cgi?id=153545

        Reviewed by Simon Fraser.

        * Configurations/FeatureDefines.xcconfig:

2016-01-25  Beth Dakin  <bdakin@apple.com>

        Build fix.

        * WebView/WebHTMLView.mm:
        (-[WebHTMLView initWithFrame:]):
        (-[WebHTMLView insertText:]):

2016-01-25  Beth Dakin  <bdakin@apple.com>

        WK1: Handle soft spaces after accepted candidates
        https://bugs.webkit.org/show_bug.cgi?id=153442
        -and corresponding-
        rdar://problem/23958418

        Reviewed by Tim Horton.

        The space at the end of candidates is a soft space. If that space exists, 
        cache the range of the space in m_softSpaceRange.
        * WebCoreSupport/WebEditorClient.mm:
        (WebEditorClient::handleAcceptedCandidate):

        New ivar in WebHTMLViewPrivate softSpaceRange keeps track to the NSRange of a 
        soft space if the last text that was inserted has a soft space at the end.
        * WebView/WebHTMLView.mm:
        (-[WebHTMLView initWithFrame:]):
        (-[WebHTMLView _setSoftSpaceRange:]):

        When new text is inserted, find out if it is being inserted right after a 
        soft space. If it is, then [NSSpellChecker deletesAutospaceBeforeString] will 
        tell us if the space needs to be removed. If that is the case, then set the 
        replacementString to the soft space.
        (-[WebHTMLView insertText:]):
        * WebView/WebHTMLViewInternal.h:

2016-01-17  Ada Chan  <adachan@apple.com>

        Add a mode parameter to MediaControllerInterface::supportsFullscreen() and ChromeClient::supportsVideoFullscreen().
        https://bugs.webkit.org/show_bug.cgi?id=153220

        Reviewed by Eric Carlson.

        * WebCoreSupport/WebChromeClient.h:
        * WebCoreSupport/WebChromeClient.mm:
        (WebChromeClient::supportsVideoFullscreen):

2016-01-22  Darin Adler  <darin@apple.com>

        Reduce use of equalIgnoringCase to just ignore ASCII case
        https://bugs.webkit.org/show_bug.cgi?id=153266

        Reviewed by Ryosuke Niwa.

        * WebCoreSupport/WebFrameLoaderClient.mm:
        (WebFrameLoaderClient::createPlugin): Use equalLettersIgnoringASCIICase.

2016-01-21  Brent Fulgham  <bfulgham@apple.com>

        [Mac] Tooltips do not honor some types of obscuring windows
        https://bugs.webkit.org/show_bug.cgi?id=153263
        <rdar://problem/21423972>

        Reviewed by Simon Fraser.

        * WebView/WebHTMLView.mm:
        (-[WebHTMLView _updateMouseoverWithEvent:]): When the WebView is not the key window, don't
        display tooltips.

2016-01-19  Ada Chan  <adachan@apple.com>

        Make it possible to enable VIDEO_PRESENTATION_MODE on other Cocoa platforms.
        https://bugs.webkit.org/show_bug.cgi?id=153218

        Reviewed by Eric Carlson.

        * Configurations/FeatureDefines.xcconfig:

2016-01-19  Beth Dakin  <bdakin@apple.com>

        32-bit build fix.

        * WebView/WebView.mm:
        (-[WebView updateWebViewAdditions]):
        (-[WebView showCandidates:forString:inRect:view:completionHandler:]):
        * WebView/WebViewInternal.h:

2016-01-19  Beth Dakin  <bdakin@apple.com>

        Move away from NSSpellChecker's showCandidates method
        https://bugs.webkit.org/show_bug.cgi?id=153254
        -and corresponding-
        rdar://problem/24216292

        Reviewed by Tim Horton.

        * WebCoreSupport/WebEditorClient.mm:
        (WebEditorClient::handleRequestedCandidates):
        * WebView/WebView.mm:
        (-[WebView updateWebViewAdditions]):
        (-[WebView showCandidates:forString:inRect:view:completionHandler:]):
        * WebView/WebViewInternal.h:

2016-01-19  Enrica Casucci  <enrica@apple.com>

        Add support for DataDetectors in WK (iOS).
        https://bugs.webkit.org/show_bug.cgi?id=152989
        rdar://problem/22855960

        Reviewed by Tim Horton.

        Adding feature definition for data detection.

        * Configurations/FeatureDefines.xcconfig:

2016-01-19  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r195300.
        https://bugs.webkit.org/show_bug.cgi?id=153244

        enrica wants more time to fix Windows (Requested by thorton on
        #webkit).

        Reverted changeset:

        "Add support for DataDetectors in WK (iOS)."
        https://bugs.webkit.org/show_bug.cgi?id=152989
        http://trac.webkit.org/changeset/195300

2016-01-19  Enrica Casucci  <enrica@apple.com>

        Add support for DataDetectors in WK (iOS).
        https://bugs.webkit.org/show_bug.cgi?id=152989
        rdar://problem/22855960

        Reviewed by Tim Horton.

        Adding feature definition for data detection.

        * Configurations/FeatureDefines.xcconfig:

2016-01-16  Myles C. Maxfield  <mmaxfield@apple.com>

        Remove TextRun::allowsRoundingHacks()
        https://bugs.webkit.org/show_bug.cgi?id=153185

        Reviewed by Simon Fraser.

        * Misc/WebKitNSStringExtras.mm:
        (-[NSString _web_drawAtPoint:font:textColor:allowingFontSmoothing:]): Deleted.
        (-[NSString _web_widthWithFont:]): Deleted.
        * WebView/WebView.mm:
        (+[WebView _setAllowsRoundingHacks:]): Deleted.
        (+[WebView _allowsRoundingHacks]): Deleted.
        * WebView/WebViewPrivate.h:

2016-01-15  Tim Horton  <timothy_horton@apple.com>

        Data detector yellow highlight location is vertically mirrored in WebKit1
        https://bugs.webkit.org/show_bug.cgi?id=152216
        <rdar://problem/23848003>

        Reviewed by Beth Dakin.

        * WebView/WebImmediateActionController.mm:
        (-[WebImmediateActionController _animationControllerForDataDetectedText]):
        (-[WebImmediateActionController _animationControllerForDataDetectedLink]):
        These assignments have no effect because they're operating on a copy, because
        TextIndicator::data() does not return a reference... so remove them.

        * WebView/WebView.mm:
        (-[WebView _setTextIndicator:withLifetime:]):
        Convert textBoundingRectInRootViewCoordinates to WebView coordinates before
        converting to Window coordinates from WebView coordinates so we get flipping right.

        (-[WebView _animationControllerForDictionaryLookupPopupInfo:]):
        (-[WebView _showDictionaryLookupPopup:]):
        Ditto for these, except in the aforementioned conversion callback.

2016-01-14  Brady Eidson  <beidson@apple.com>

        Modern IDB: Support opening and deleting SQLite databases on disk.
        https://bugs.webkit.org/show_bug.cgi?id=153084

        Reviewed by Alex Christensen, Sam Weinig and Andy Estes (oh my!).

        * Storage/WebDatabaseProvider.mm: Copied from Source/WebKit/Storage/WebDatabaseProvider.cpp.
        (WebDatabaseProvider::indexedDatabaseDirectoryPath):

2016-01-14  Beth Dakin  <bdakin@apple.com>

        WK1 and WK2 should share more candidate request code
        https://bugs.webkit.org/show_bug.cgi?id=153108

        Reviewed by Simon Fraser.

        requestCandidatesForSelection() does not need to be exposed as an 
        EditorClient function. WK1 can just call invoke this code from the existing 
        respondToChangedSelection EditorClient function, which is what WK2 does.
        * WebCoreSupport/WebEditorClient.h:
        * WebCoreSupport/WebEditorClient.mm:
        (WebEditorClient::respondToChangedSelection):

        Cleanup â€” use some code that was moved to WebCore::Editor.
        (WebEditorClient::requestCandidatesForSelection):
        (WebEditorClient::handleRequestedCandidates):
        (textCheckingResultFromNSTextCheckingResult):
        (WebEditorClient::handleAcceptedCandidate):
        (candidateRangeForSelection): Deleted.
        (candidateWouldReplaceText): Deleted.

2016-01-13  Chris Dumez  <cdumez@apple.com>

        Unreviewed, rolling out r194900.

        Roll back in as this did not actually regress PLT

        Reverted changeset:

        "Unreviewed, rolling out r194826."
        https://bugs.webkit.org/show_bug.cgi?id=153020
        http://trac.webkit.org/changeset/194900

2016-01-12  Ryosuke Niwa  <rniwa@webkit.org>

        Add a build flag for custom element
        https://bugs.webkit.org/show_bug.cgi?id=153005

        Reviewed by Alex Christensen.

        * Configurations/FeatureDefines.xcconfig:

2016-01-12  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r194826.
        https://bugs.webkit.org/show_bug.cgi?id=153020

        Appears to have regressed PLT (Requested by kling on #webkit).

        Reverted changeset:

        "Use NeverDestroyed instead of DEPRECATED_DEFINE_STATIC_LOCAL
        cont'd"
        https://bugs.webkit.org/show_bug.cgi?id=152902
        http://trac.webkit.org/changeset/194826

2016-01-11  Anders Carlsson  <andersca@apple.com>

        Get rid of CFMakeCollectable, it is a no-op
        https://bugs.webkit.org/show_bug.cgi?id=152988

        Reviewed by Sam Weinig.

        * Misc/WebNSDataExtras.m:
        (-[NSString _web_capitalizeRFC822HeaderFieldName]):
        (-[NSData _webkit_parseRFC822HeaderFields]):
        * Plugins/WebPluginController.mm:
        (-[WebPluginController initWithDocumentView:]):

2016-01-10  Andreas Kling  <akling@apple.com>

        Use NeverDestroyed instead of DEPRECATED_DEFINE_STATIC_LOCAL cont'd
        <https://webkit.org/b/152902>

        Reviewed by Andy Estes.

        Convert some more of the remaining clients to use NeverDestroyed.

        * History/WebBackForwardList.mm:
        (backForwardLists):
        * History/WebHistoryItem.mm:
        (historyItemWrappers):
        * Misc/WebNSPasteboardExtras.mm:
        (+[NSPasteboard _web_writableTypesForURL]):
        (_writableTypesForImageWithoutArchive):
        (_writableTypesForImageWithArchive):
        * Plugins/Hosted/NetscapePluginHostManager.mm:
        (WebKit::NetscapePluginHostManager::singleton):
        * Plugins/Hosted/NetscapePluginHostProxy.mm:
        (WebKit::pluginProxyMap):
        * Plugins/Hosted/NetscapePluginInstanceProxy.mm:
        (WebKit::globalExceptionString):
        * Plugins/Hosted/ProxyInstance.mm:
        (WebKit::proxyClass):
        * Plugins/WebNetscapePluginStream.mm:
        (streams):
        * Storage/WebDatabaseManager.mm:
        (transactionBackgroundTaskIdentifierLock):
        * WebCoreSupport/WebUserMediaClient.mm:
        (userMediaCheckMap):
        * WebView/WebHTMLRepresentation.mm:
        (regExpForLabels):
        * WebView/WebView.mm:
        (aeDescFromJSValue):

2016-01-09  Dan Bernstein  <mitz@apple.com>

        [Cocoa] Allow overriding the frameworks directory independently of using a staging install path
        https://bugs.webkit.org/show_bug.cgi?id=152926

        Reviewed by Tim Horton.

        Introduce a new build setting, WK_OVERRIDE_FRAMEWORKS_DIR. When not empty, it determines
        where the frameworks are installed. Setting USE_STAGING_INSTALL_PATH to YES sets
        WK_OVERRIDE_FRAMEWORKS_DIR to $(SYSTEM_LIBRARY_DIR)/StagedFrameworks/Safari.

        Account for the possibility of WK_OVERRIDE_FRAMEWORKS_DIR containing spaces.

        * Configurations/WebKitLegacy.xcconfig:
        - Replace STAGED_FRAMEWORKS_SEARCH_PATH in FRAMEWORK_SEARCH_PATHS with
          WK_OVERRIDE_FRAMEWORKS_DIR and add quotes to account for spaces.
        - Define WEBKIT_LEGACY_FRAMEWORKS_DIR, PRODUCTION_FRAMEWORKS_DIR, and
          WEBCORE_PRIVATE_HEADERS_DIR based on WK_OVERRIDE_FRAMEWORKS_DIR.

        * MigrateHeaders.make:
          Use a symlink under BUILT_PRODUCTS_DIR to the WebCore Private Headers. Use a
          BUILT_PRODUCTS_DIR-based path to the framework instead of a TARGET_BUILD_DIR-based one in
          order to avoid spaces.
        * migrate-headers.sh:
          Make the symlink to WEBCORE_PRIVATE_HEADERS_DIR that the makefile now uses.

2016-01-07  Tim Horton  <timothy_horton@apple.com>

        Can't play inline video in a stock WK1 WebView on Mac
        https://bugs.webkit.org/show_bug.cgi?id=152860

        Rubber-stamped by Jer Noble.

        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):
        The default for this preference is supposed to be NO on Mac. It is in
        Settings.in, and in WebKit2, but this one place got it wrong.

2016-01-06  Simon Fraser  <simon.fraser@apple.com>

        Add a setting and preferences to enable display-list drawing. Does nothing yet.
        https://bugs.webkit.org/show_bug.cgi?id=152807

        Reviewed by Zalan Bujtas.
        
        WK1 pref for display-list drawing, defaults to off.

        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):
        (-[WebPreferences displayListDrawingEnabled]):
        (-[WebPreferences setDisplayListDrawingEnabled:]):
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView initSimpleHTMLDocumentWithStyle:frame:preferences:groupName:]):
        (-[WebView _preferencesChanged:]):

2016-01-06  Simon Fraser  <simon.fraser@apple.com>

        [iOS] Revert overflow:hidden on the body affecting viewport scale (r186786)
        https://bugs.webkit.org/show_bug.cgi?id=152803
        rdar://problem/22242515

        Reviewed by Tim Horton.

        * WebView/WebView.mm:
        (-[WebView _contentsSizeRespectingOverflow]): Keep this function which is used
        by UIKit, but change the implementation to just return the document size.

2016-01-04  Tim Horton  <timothy_horton@apple.com>

        Turn on gesture events when building for Yosemite
        https://bugs.webkit.org/show_bug.cgi?id=152704
        rdar://problem/24042472

        Reviewed by Anders Carlsson.

        * Configurations/FeatureDefines.xcconfig:

2015-12-31  Andy Estes  <aestes@apple.com>

        Replace WTF::move with WTFMove
        https://bugs.webkit.org/show_bug.cgi?id=152601

        Reviewed by Brady Eidson.

        * History/WebHistoryItem.mm:
        (-[WebHistoryItem initFromDictionaryRepresentation:]):
        * Plugins/Hosted/HostedNetscapePluginStream.mm:
        (WebKit::HostedNetscapePluginStream::willSendRequest):
        * Plugins/Hosted/NetscapePluginInstanceProxy.h:
        (WebKit::NetscapePluginInstanceProxy::setCurrentReply):
        * Plugins/WebNetscapePluginStream.mm:
        (WebNetscapePluginStream::willSendRequest):
        * Plugins/WebNetscapePluginView.mm:
        (-[WebNetscapePluginView scheduleTimerWithInterval:repeat:timerFunc:]):
        * WebCoreSupport/WebContextMenuClient.mm:
        (WebContextMenuClient::imageForCurrentSharingServicePickerItem):
        * WebCoreSupport/WebFrameLoaderClient.mm:
        (WebFrameLoaderClient::dispatchDecidePolicyForResponse):
        (WebFrameLoaderClient::dispatchDecidePolicyForNewWindowAction):
        (WebFrameLoaderClient::dispatchDecidePolicyForNavigationAction):
        (WebFrameLoaderClient::dispatchWillSubmitForm):
        (WebFrameLoaderClient::createDocumentLoader):
        * WebCoreSupport/WebInspectorClient.mm:
        (WebInspectorFrontendClient::WebInspectorFrontendClient):
        * WebView/WebArchive.mm:
        (-[WebArchive initWithMainResource:subresources:subframeArchives:]):
        * WebView/WebFrame.mm:
        (-[WebFrame _documentFragmentWithNodesAsParagraphs:]):
        * WebView/WebHTMLView.mm:
        (-[WebHTMLView _applyEditingStyleToSelection:withUndoAction:]):
        * WebView/WebMediaPlaybackTargetPicker.mm:
        (WebMediaPlaybackTargetPicker::setPlaybackTarget):
        * WebView/WebView.mm:
        (-[WebView _loadBackForwardListFromOtherView:]):
        (+[WebView _addUserScriptToGroup:world:source:url:whitelist:blacklist:injectionTime:injectedFrames:]):
        (+[WebView _addUserStyleSheetToGroup:world:source:url:whitelist:blacklist:injectedFrames:]):

2016-01-01  Simon Fraser  <simon.fraser@apple.com>

        Fix the iOS and EFL builds, after an over-eager commit-queue commit.

        * History/WebHistoryItem.mm:
        (-[WebHistoryItem initFromDictionaryRepresentation:]):

2016-01-01  Simon Fraser  <simon.fraser@apple.com>

        Fix naming in HistoryItem to refer to scrollPositions
        https://bugs.webkit.org/show_bug.cgi?id=152646

        Reviewed by Zalan Bujtas.

        HistoryItem stores a scrollPosition, so call it that.

        * History/WebHistoryItem.mm:
        (-[WebHistoryItem scrollPoint]):

2016-01-01  Jeff Miller  <jeffm@apple.com>

        Update user-visible copyright strings to include 2016
        https://bugs.webkit.org/show_bug.cgi?id=152531

        Reviewed by Alexey Proskuryakov.

        * Info.plist:

2015-12-31  David Kilzer  <ddkilzer@apple.com>

        Stop using USE(CFNETWORK) path on iOS
        https://bugs.webkit.org/show_bug.cgi?id=142540

        Step 1/2: Do everything but turn off USE(CFNETWORK) internally.

        Original patch by Antti Koivisto <antti@apple.com> on 2015-03-10
        Reviewed by Daniel Bates.

        * Misc/WebDownload.h: Add header guard to make
        NSURLDownloadSPI.h work when pre-declaring NSURLDownload object.
        * Misc/WebKitVersionChecks.h: Define
        WEBKIT_FIRST_VERSION_WITH_LOADING_DURING_COMMON_RUNLOOP_MODES
        for iOS.
        * WebView/WebView.mm:
        (-[WebView _commonInitializationWithFrameName:groupName:]): Use
        the correct runloop on iOS.
        * WebView/WebViewPrivate.h:
        (-[WebView(WebPendingPublic) scheduleInRunLoop:forMode:]):
        (-[WebView(WebPendingPublic) unscheduleFromRunLoop:forMode:]):
        - These are available on iOS now.

2015-12-31  Simon Fraser  <simon.fraser@apple.com>

        Clarify that scrollPositionChangedViaPlatformWidget takes offsets
        https://bugs.webkit.org/show_bug.cgi?id=152606

        Reviewed by Zalan Bujtas.

        scrollPositionChangedViaPlatformWidget actually gets scroll offsets, since the
        values we get from AppKit are zero-based, so rename to scrollOffsetChangedViaPlatformWidget().
        
        Change ScrollableArea's setScrollPosition() and requestScrollPositionUpdate() to take
        ScrollPositions.
        
        Add a FIXME noting that willRevealEdge events are probably broken in RTL documents.

        * WebView/WebHTMLView.mm:
        (-[WebHTMLView _frameOrBoundsChanged]):

2015-12-22  Andy Estes  <aestes@apple.com>

        [CF] Replace CFNetwork-related WebKitSystemInterface calls with SPI
        https://bugs.webkit.org/show_bug.cgi?id=152463

        Reviewed by Alexey Proskuryakov.

        Replaced WebkitSystemInterface calls that wrapped CFNetwork SPI with direct calls to SPI that is now forward
        declared in CFNetworkSPI.h.

        * Plugins/Hosted/HostedNetscapePluginStream.mm:
        (WebKit::HostedNetscapePluginStream::didReceiveResponse):
        * Plugins/WebNetscapePluginStream.mm:
        (WebNetscapePluginStream::didReceiveResponse):
        * WebCoreSupport/WebSystemInterface.mm:
        (InitWebCoreSystemInterface): Deleted.
        * WebView/WebPreferences.mm:
        (+[WebPreferences _setCurrentNetworkLoaderSessionCookieAcceptPolicy:]):

2015-12-20  Dan Bernstein  <mitz@apple.com>

        Remove unused setToolbarHeight
        https://bugs.webkit.org/show_bug.cgi?id=152466

        Reviewed by Darin Adler.

        * WebCoreSupport/WebInspectorClient.h:
        * WebCoreSupport/WebInspectorClient.mm::
        (WebInspectorFrontendClient::setToolbarHeight): Deleted.

2015-12-19  Dan Bernstein  <mitz@apple.com>

        [Mac] WebKit contains dead source code for OS X Mavericks and earlier
        https://bugs.webkit.org/show_bug.cgi?id=152462

        Reviewed by Alexey Proskuryakov.

        - Removed build setting definitions for OS X 10.9 and earlier, and simplified defintions
          that became uniform across all OS X versions as a result:

        * Configurations/DebugRelease.xcconfig:
        * Configurations/FeatureDefines.xcconfig:
        * Configurations/Version.xcconfig:
        * Configurations/WebKitLegacy.xcconfig:

        - Simplified expressions involving __MAC_OS_X_VERSION_MIN_REQUIRED and removed code that was
          never getting compiled:

        * WebCoreSupport/WebInspectorClient.mm:
        * WebView/WebDynamicScrollBarsView.mm:
        * WebView/WebHTMLView.mm:
        * WebView/WebImmediateActionController.h:
        * WebView/WebImmediateActionController.mm:
        * WebView/WebView.mm:
        * WebView/WebViewData.h:
        * WebView/WebViewData.mm:
        * WebView/WebViewInternal.h:

2015-12-17  Tim Horton  <timothy_horton@apple.com>

        Data detector yellow highlight location is vertically mirrored in WebKit1
        https://bugs.webkit.org/show_bug.cgi?id=152216
        <rdar://problem/23848003>

        Reviewed by Darin Adler.

        * WebView/WebImmediateActionController.mm:
        (-[WebImmediateActionController _animationControllerForDataDetectedText]):
        Match the conversion we do at every other WK1 TextIndicator construction.

2015-12-16  Youenn Fablet  <youenn.fablet@crf.canon.fr>

        [Fetch API] Add fetch API compile time flag
        https://bugs.webkit.org/show_bug.cgi?id=152254

        Reviewed by Darin Adler.

        * Configurations/FeatureDefines.xcconfig:

2015-12-13  Tim Horton  <timothy_horton@apple.com>

        Adopt CGIOSurfaceContextCreateImageReference to avoid unnecessary readback
        https://bugs.webkit.org/show_bug.cgi?id=150988
        <rdar://problem/18993594>

        Reviewed by Darin Adler.

        * WebCoreSupport/WebContextMenuClient.mm:
        (WebContextMenuClient::imageForCurrentSharingServicePickerItem):
        Adopt sinkIntoImage and drawConsumingImageBuffer in a few places.

2015-12-11  Eric Carlson  <eric.carlson@apple.com>

        [MediaStream] Add a setting to allow the mock media capture devices to be enabled and disabled
        https://bugs.webkit.org/show_bug.cgi?id=152197

        Reviewed by Dean Jackson.

        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (+[WebPreferences initialize]):
        (-[WebPreferences mockCaptureDevicesEnabled]):
        (-[WebPreferences setMockCaptureDevicesEnabled:]):
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):

2015-12-11  Beth Dakin  <bdakin@apple.com>

        _touchEventRegions should return regions in the view's coordinates
        https://bugs.webkit.org/show_bug.cgi?id=152189
        -and corresponding-
        rdar://problem/23188605

        Reviewed by Dan Bernstein.

        The comment here was actually out of date. It claimed that touch rectangles 
        are in the coordinate system of the document, but we had actually changed 
        them to be in the viewâ€™s coordinate system in order to fix issues with 
        handling touch events in UIWebView. But now we are going back to having the 
        touch rectangles be in the documentâ€™s coordinate system, so we should fix the 
        rtl bugs here by converting to view coordinates before handing the rects off 
        to iOS WK1 clients.
        * WebView/WebView.mm:
        (-[WebView _touchEventRegions]):

2015-12-10  Eric Carlson  <eric.carlson@apple.com>

        [MediaStream] Expose media capture devices persistent permissions to WebCore
        https://bugs.webkit.org/show_bug.cgi?id=152087

        Reviewed by Chris Dumez.

        Add methods and helpers for WK1 permission checker interface.
        * WebCoreSupport/WebUserMediaClient.h:
        * WebCoreSupport/WebUserMediaClient.mm:
        (userMediaRequestsMap):
        (AddRequestToRequestMap):
        (RemoveRequestFromRequestMap):
        (userMediaCheckMap):
        (AddPermissionCheckToMap):
        (RemovePermissionCheckFromMap):
        (WebUserMediaClient::WebUserMediaClient):
        (WebUserMediaClient::requestUserMediaAccess):
        (WebUserMediaClient::cancelUserMediaAccessRequest):
        (WebUserMediaClient::checkUserMediaPermission):
        (WebUserMediaClient::cancelUserMediaPermissionCheck):
        (-[WebUserMediaPolicyListener allow]):
        (-[WebUserMediaPolicyListener deny]):
        (-[WebUserMediaPolicyCheckerListener initWithUserMediaPermissionCheck:]):
        (-[WebUserMediaPolicyCheckerListener cancelUserMediaPermissionCheck]):
        (-[WebUserMediaPolicyCheckerListener allow]):
        (-[WebUserMediaPolicyCheckerListener deny]):
        (-[WebUserMediaPolicyCheckerListener denyOnlyThisRequest]):
        (-[WebUserMediaPolicyCheckerListener shouldClearCache]):
        (AddRequestToMap): Deleted.
        (RemoveRequestFromMap): Deleted.
        * WebView/WebUIDelegatePrivate.h:

2015-12-08  Beth Dakin  <bdakin@apple.com>

        Follow-up to:
        Add support for WebViewAdditions
        https://bugs.webkit.org/show_bug.cgi?id=151967

        Rubber-stamped by Dan Bernstein.

        We should use the Web prefix for all category names.
        * WebView/WebView.mm:
        (-[WebView updateWebViewAdditions]):
        * WebView/WebViewInternal.h:

2015-12-08  Eric Carlson  <eric.carlson@apple.com>

        [MediaStream] Rename UserMediaClient and UserMediaController methods
        https://bugs.webkit.org/show_bug.cgi?id=152001

        Reviewed by Brady Eidson.

        * WebCoreSupport/WebUserMediaClient.h:
        * WebCoreSupport/WebUserMediaClient.mm:
        (WebUserMediaClient::pageDestroyed):
        (WebUserMediaClient::requestUserMediaAccess):
        (WebUserMediaClient::cancelUserMediaAccessRequest):
        (-[WebUserMediaPolicyListener initWithUserMediaRequest:]):
        (-[WebUserMediaPolicyListener cancelUserMediaAccessRequest]):
        (WebUserMediaClient::requestPermission): Deleted.
        (WebUserMediaClient::cancelRequest): Deleted.
        (-[WebUserMediaPolicyListener cancelRequest]): Deleted.

2015-12-07  Alex Christensen  <achristensen@webkit.org>

        Build fix after r193675.

        * WebView/WebViewData.h:

2015-12-07  Alex Christensen  <achristensen@webkit.org>

        Build fix after r193661.

        Reviewed by Beth Dakin.

        * WebView/WebViewData.h:

2015-12-07  Beth Dakin  <bdakin@apple.com>

        Add support for WebViewAdditions
        https://bugs.webkit.org/show_bug.cgi?id=151967

        Reviewed by Sam Weinig.

        * WebCoreSupport/WebEditorClient.mm:
        (WebEditorClient::respondToChangedSelection):
        * WebView/WebView.mm:
        (-[WebView _commonInitializationWithFrameName:groupName:]):
        (-[WebView updateWebViewAdditions]):
        * WebView/WebViewData.h:
        * WebView/WebViewInternal.h:

2015-12-07  Beth Dakin  <bdakin@apple.com>

        Hook up request and show for typing candidates in WK1
        https://bugs.webkit.org/show_bug.cgi?id=151831
        -and corresponding-
        <rdar://problem/23751214>

        Reviewed by Enrica Casucci.

        Add member variables to WebEditorClient. One is a WeakPtrFactory for the 
        asynchronous handlers, and the other caches the VisibleSelection at the time 
        candidates were requested so that we can make sure the candidates are still 
        valid once we receive them.
        * WebCoreSupport/WebEditorClient.h:
        * WebCoreSupport/WebEditorClient.mm:
        (WebEditorClient::WebEditorClient):

        Call [NSSpellChecker requestCandidatesForSelectedRange] with the appropriate 
        parameters.
        (WebEditorClient::requestCandidatesForSelection):

        Two helpers to compute information that we need for both of the handlers 
        below.
        (candidateRangeForSelection):
        (candidateWouldReplaceText):

        In this handler, we just need to call [NSSpellChecker showCandidates] with 
        the appropriate parameters.
        (WebEditorClient::handleRequestedCandidates):

        Once a candidate is accepted, it should be inserted in the right way.
        (WebEditorClient::handleAcceptedCandidate):

2015-12-03  Jer Noble  <jer.noble@apple.com>

        Expose WebCore's InvisibleAutoplayNotPermitted setting to WebKit & WebKit2
        https://bugs.webkit.org/show_bug.cgi?id=151830

        Reviewed by Anders Carlsson.

        Add a new WebPreferences property invisibleAutoplayNotPermitted.

        * WebView/WebPreferenceKeysPrivate.h:
        * WebView/WebPreferences.mm:
        (-[WebPreferences invisibleAutoplayNotPermitted]):
        (-[WebPreferences setInvisibleAutoplayNotPermitted:]):
        * WebView/WebPreferencesPrivate.h:
        * WebView/WebView.mm:
        (-[WebView _preferencesChanged:]):

2015-12-03  Anders Carlsson  <andersca@apple.com>

        Remove Objective-C GC support
        https://bugs.webkit.org/show_bug.cgi?id=151819
        rdar://problem/23746991

        Reviewed by Dan Bernstein.

        * Carbon/CarbonWindowAdapter.mm:
        (+[CarbonWindowAdapter initialize]): Deleted.
        (-[CarbonWindowAdapter finalize]): Deleted.
        * Configurations/Base.xcconfig:
        * History/WebBackForwardList.mm:
        (+[WebBackForwardList initialize]): Deleted.
        (-[WebBackForwardList finalize]): Deleted.
        * History/WebHistory.mm:
        (-[WebHistoryPrivate finalize]): Deleted.
        (-[WebHistory finalize]): Deleted.
        * History/WebHistoryItem.mm:
        (+[WebHistoryItem initialize]): Deleted.
        (-[WebHistoryItem finalize]): Deleted.
        * Misc/WebElementDictionary.mm:
        (+[WebElementDictionary initialize]): Deleted.
        (-[WebElementDictionary finalize]): Deleted.
        * Plugins/Hosted/WebHostedNetscapePluginView.mm:
        (+[WebHostedNetscapePluginView initialize]): Deleted.
        * Plugins/WebBaseNetscapePluginView.mm:
        (-[WebBaseNetscapePluginView finalize]): Deleted.
        * Plugins/WebBasePluginPackage.mm:
        (-[WebBasePluginPackage finalize]): Deleted.
        * Plugins/WebNetscapePluginView.mm:
        (+[WebNetscapePluginView initialize]): Deleted.
        (-[WebNetscapePluginView finalize]): Deleted.
        * Plugins/WebPluginContainerCheck.mm:
        (-[WebPluginContainerCheck finalize]): Deleted.
        * WebCoreSupport/WebEditorClient.mm:
        (+[WebUndoStep initialize]): Deleted.
        (-[WebUndoStep finalize]): Deleted.
        * WebCoreSupport/WebFrameLoaderClient.mm:
        * WebCoreSupport/WebOpenPanelResultListener.mm:
        (-[WebOpenPanelResultListener finalize]): Deleted.
        * WebCoreSupport/WebSecurityOrigin.mm:
        (-[WebSecurityOrigin finalize]): Deleted.
        * WebView/WebArchive.mm:
        (+[WebArchivePrivate initialize]): Deleted.
        * WebView/WebDataSource.mm:
        (+[WebDataSource initialize]): Deleted.
        (-[WebDataSource finalize]): Deleted.
        * WebView/WebDynamicScrollBarsView.mm:
        (-[WebDynamicScrollBarsView finalize]): Deleted.
        * WebView/WebFrame.mm:
        (-[WebFramePrivate setWebFrameView:]):
        (-[WebFramePrivate finalize]): Deleted.
        (-[WebFrame finalize]): Deleted.
        * WebView/WebFrameView.mm:
        (-[WebFrameView finalize]): Deleted.
        * WebView/WebHTMLRepresentation.mm:
        (-[WebHTMLRepresentation finalize]): Deleted.
        * WebView/WebHTMLView.mm:
        (+[WebHTMLViewPrivate initialize]):
        (-[WebHTMLViewPrivate finalize]): Deleted.
        (+[WebHTMLView initialize]): Deleted.
        (-[WebHTMLView finalize]): Deleted.
        * WebView/WebResource.mm:
        (+[WebResourcePrivate initialize]): Deleted.
        (-[WebResourcePrivate finalize]): Deleted.
        * WebView/WebTextIterator.mm:
        (+[WebTextIteratorPrivate initialize]): Deleted.
        * WebView/WebView.mm:
        (-[WebView finalize]): Deleted.
        * WebView/WebViewData.mm:
        (+[WebViewPrivate initialize]): Deleted.
        (-[WebViewPrivate init]): Deleted.
        (-[WebViewPrivate finalize]): Deleted.

2015-12-02  Antti Koivisto  <antti@apple.com>

        Move ResourceLoadScheduler to WebKit1
        https://bugs.webkit.org/show_bug.cgi?id=151743

        Reviewed by Alex Christensen.

        * Plugins/Hosted/HostedNetscapePluginStream.mm:
        (WebKit::HostedNetscapePluginStream::start):
        (WebKit::HostedNetscapePluginStream::stop):
        * Plugins/WebNetscapePluginStream.mm:
        (WebNetscapePluginStream::start):
        (WebNetscapePluginStream::stop):
        * WebCoreSupport/WebPlatformStrategies.h:
        * WebCoreSupport/WebPlatformStrategies.mm:
        (WebPlatformStrategies::createLoaderStrategy):
        (WebPlatformStrategies::createPasteboardStrategy):
        (WebPlatformStrategies::createPluginStrategy):
        (WebPlatformStrategies::createBlobRegistry):
        (WebPlatformStrategies::cookiesForDOM):
        * WebView/WebView.mm:
        (-[WebView _dispatchPendingLoadRequests]):
        (+[WebView _setLoadResourcesSerially:]):
        (+[WebView _HTTPPipeliningEnabled]):

2015-12-01  Yusuke Suzuki  <utatane.tea@gmail.com>

        [ES6] Implement LLInt/Baseline Support for ES6 Generators and enable this feature
        https://bugs.webkit.org/show_bug.cgi?id=150792

        Reviewed by Saam Barati.

        * Configurations/FeatureDefines.xcconfig:

2015-12-01  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, rolling out r192914.
        https://bugs.webkit.org/show_bug.cgi?id=151734

        JSC tests for this change are failing on 32 and 64-bit bots
        (Requested by ryanhaddad on #webkit).

        Reverted changeset:

        "[ES6] Implement LLInt/Baseline Support for ES6 Generators and
        enable this feature"
        https://bugs.webkit.org/show_bug.cgi?id=150792
        http://trac.webkit.org/changeset/192914

2015-12-01  Yusuke Suzuki  <utatane.tea@gmail.com>

        [ES6] Implement LLInt/Baseline Support for ES6 Generators and enable this feature
        https://bugs.webkit.org/show_bug.cgi?id=150792

        Reviewed by Saam Barati.

        * Configurations/FeatureDefines.xcconfig:

2015-11-30  Katlyn Graff  <kgraff@apple.com>

        Rename ActiveDOMObject/DOMWindow PageCacheSuspension code to support more reasons for suspension
        https://bugs.webkit.org/show_bug.cgi?id=151677

        Reviewed by Ryosuke Niwa.

        * WebView/WebFrame.mm:
        (-[WebFrame _cacheabilityDictionary]):

2015-11-30  Jiewen Tan  <jiewen_tan@apple.com>

        Null dereference loading Blink layout test http/tests/misc/detach-during-notifyDone.html
        https://bugs.webkit.org/show_bug.cgi?id=149309
        <rdar://problem/22748363>

        Reviewed by Brent Fulgham.

        * WebView/WebDataSource.mm:
        (WebDataSourcePrivate::~WebDataSourcePrivate):
        Refine the assertion to treat <rdar://problem/9673866>.

== Rolled over to ChangeLog-2015-11-21 ==
